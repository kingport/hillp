import{a2 as bt,a3 as wt,aB as st,aw as Ct,aC as Nt,aD as rt,r as m,a4 as it,b as e,g as ye,ae as St,j as l,aE as Ze,am as ze,u as ve,S as A,an as Dt,a1 as Ft,i as _t,s as Te,k as J,a0 as o,aF as ie,B as $t,aG as et,aH as Mt,T as tt,F as ce,$ as Yt,Y as Et,aI as kt,aJ as Bt,aK as nt,aL as Ht,aM as Tt}from"./index.5670e6e0.js";import{P as Ge}from"./index.c6660251.js";import{C as lt}from"./index.4b5b1278.js";import{L as Re,H as At}from"./index.04556cd2.js";import{S as pe}from"./index.3e941e25.js";import{P as Lt}from"./index.31244c45.js";import{D as ot,S as jt}from"./dropdown.706ec38f.js";import{M as Ot}from"./index.c5e480b2.js";import{u as ct}from"./index.5733fb44.js";import{M as ge}from"./manage.653bb3f0.js";import{H as It}from"./index.9fe94518.js";import{D as qe}from"./index.60148415.js";import{d as N}from"./dayjs.min.37299693.js";import{R as Ae,F as he}from"./index.11c9b67d.js";import{D as Pt}from"./DownOutlined.9a14fa90.js";import{C as at}from"./index.88567fed.js";import{S as Vt}from"./Skeleton.c599669d.js";import{F as re}from"./index.fcc496e2.js";import{S as Gt}from"./index.0a2bddee.js";import{I as Rt}from"./index.0edfa0b7.js";import{T as Le}from"./index.a27bccdf.js";import{s as xe}from"./index.module.f30b2635.js";import{E as qt}from"./index.1c39e7a0.js";import{P as Ie}from"./index.77a6b2f7.js";import{M as dt}from"./index.9bb4ee10.js";import{u as Xt}from"./index.983b0d64.js";import{P as Pe}from"./PickerContent.7accd0df.js";/* empty css                    *//* empty css                 */import"./isoWeek.f8ad8697.js";import"./dev-log.6e115cc9.js";import"./use-gesture-react.esm.346ddc85.js";import"./bound.bddb6539.js";import"./index.cb878f88.js";import"./convert-px.daab3cc2.js";import"./PurePanel.2a417db7.js";import"./index.42a6e0fb.js";import"./index.92e459fd.js";import"./collapse.e34cf270.js";import"./useFlexGapSupport.172cfcf4.js";import"./statusUtils.6dc02607.js";import"./index.a450b78e.js";import"./is-node-with-content.f661b98b.js";import"./interopRequireDefault.fc5525a1.js";import"./native-input.0c0515ca.js";import"./row.06620ecf.js";import"./SearchOutlined.a0283b8c.js";import"./rubberband.c88fa690.js";import"./index.af3e2847.js";const Ut="_calendar_15895_1",Wt={calendar:Ut},Kt=new st("antSpinMove",{to:{opacity:1}}),Jt=new st("antRotate",{to:{transform:"rotate(405deg)"}}),Qt=n=>({[`${n.componentCls}`]:Object.assign(Object.assign({},Ct(n)),{position:"absolute",display:"none",color:n.colorPrimary,textAlign:"center",verticalAlign:"middle",opacity:0,transition:`transform ${n.motionDurationSlow} ${n.motionEaseInOutCirc}`,"&-spinning":{position:"static",display:"inline-block",opacity:1},"&-nested-loading":{position:"relative",[`> div > ${n.componentCls}`]:{position:"absolute",top:0,insetInlineStart:0,zIndex:4,display:"block",width:"100%",height:"100%",maxHeight:n.contentHeight,[`${n.componentCls}-dot`]:{position:"absolute",top:"50%",insetInlineStart:"50%",margin:-n.spinDotSize/2},[`${n.componentCls}-text`]:{position:"absolute",top:"50%",width:"100%",paddingTop:(n.spinDotSize-n.fontSize)/2+2,textShadow:`0 1px 2px ${n.colorBgContainer}`},[`&${n.componentCls}-show-text ${n.componentCls}-dot`]:{marginTop:-(n.spinDotSize/2)-10},"&-sm":{[`${n.componentCls}-dot`]:{margin:-n.spinDotSizeSM/2},[`${n.componentCls}-text`]:{paddingTop:(n.spinDotSizeSM-n.fontSize)/2+2},[`&${n.componentCls}-show-text ${n.componentCls}-dot`]:{marginTop:-(n.spinDotSizeSM/2)-10}},"&-lg":{[`${n.componentCls}-dot`]:{margin:-(n.spinDotSizeLG/2)},[`${n.componentCls}-text`]:{paddingTop:(n.spinDotSizeLG-n.fontSize)/2+2},[`&${n.componentCls}-show-text ${n.componentCls}-dot`]:{marginTop:-(n.spinDotSizeLG/2)-10}}},[`${n.componentCls}-container`]:{position:"relative",transition:`opacity ${n.motionDurationSlow}`,"&::after":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,zIndex:10,width:"100%",height:"100%",background:n.colorBgContainer,opacity:0,transition:`all ${n.motionDurationSlow}`,content:'""',pointerEvents:"none"}},[`${n.componentCls}-blur`]:{clear:"both",opacity:.5,userSelect:"none",pointerEvents:"none",["&::after"]:{opacity:.4,pointerEvents:"auto"}}},["&-tip"]:{color:n.spinDotDefault},[`${n.componentCls}-dot`]:{position:"relative",display:"inline-block",fontSize:n.spinDotSize,width:"1em",height:"1em","&-item":{position:"absolute",display:"block",width:(n.spinDotSize-n.marginXXS/2)/2,height:(n.spinDotSize-n.marginXXS/2)/2,backgroundColor:n.colorPrimary,borderRadius:"100%",transform:"scale(0.75)",transformOrigin:"50% 50%",opacity:.3,animationName:Kt,animationDuration:"1s",animationIterationCount:"infinite",animationTimingFunction:"linear",animationDirection:"alternate","&:nth-child(1)":{top:0,insetInlineStart:0},"&:nth-child(2)":{top:0,insetInlineEnd:0,animationDelay:"0.4s"},"&:nth-child(3)":{insetInlineEnd:0,bottom:0,animationDelay:"0.8s"},"&:nth-child(4)":{bottom:0,insetInlineStart:0,animationDelay:"1.2s"}},"&-spin":{transform:"rotate(45deg)",animationName:Jt,animationDuration:"1.2s",animationIterationCount:"infinite",animationTimingFunction:"linear"}},[`&-sm ${n.componentCls}-dot`]:{fontSize:n.spinDotSizeSM,i:{width:(n.spinDotSizeSM-n.marginXXS/2)/2,height:(n.spinDotSizeSM-n.marginXXS/2)/2}},[`&-lg ${n.componentCls}-dot`]:{fontSize:n.spinDotSizeLG,i:{width:(n.spinDotSizeLG-n.marginXXS)/2,height:(n.spinDotSizeLG-n.marginXXS)/2}},[`&${n.componentCls}-show-text ${n.componentCls}-text`]:{display:"block"}})}),Zt=bt("Spin",n=>{const i=wt(n,{spinDotDefault:n.colorTextDescription,spinDotSize:n.controlHeightLG/2,spinDotSizeSM:n.controlHeightLG*.35,spinDotSizeLG:n.controlHeight});return[Qt(i)]},{contentHeight:400});var zt=Nt;function en(n,i,c){for(var p=-1,w=n.length;++p<w;){var x=n[p],d=i(x);if(d!=null&&(S===void 0?d===d&&!zt(d):c(d,S)))var S=d,O=x}return O}var mt=en;function tn(n,i){return n<i}var nn=tn,an=mt,sn=nn,rn=rt;function ln(n){return n&&n.length?an(n,rn,sn):void 0}var on=ln;function cn(n,i,c){var p=c||{},w=p.noTrailing,x=w===void 0?!1:w,d=p.noLeading,S=d===void 0?!1:d,O=p.debounceMode,E=O===void 0?void 0:O,H,D=!1,I=0;function $(){H&&clearTimeout(H)}function C(M){var V=M||{},r=V.upcomingOnly,y=r===void 0?!1:r;$(),D=!y}function L(){for(var M=arguments.length,V=new Array(M),r=0;r<M;r++)V[r]=arguments[r];var y=this,k=Date.now()-I;if(D)return;function T(){I=Date.now(),i.apply(y,V)}function G(){H=void 0}!S&&E&&!H&&T(),$(),E===void 0&&k>n?S?(I=Date.now(),x||(H=setTimeout(E?G:T,n))):T():x!==!0&&(H=setTimeout(E?G:T,E===void 0?n-k:n))}return L.cancel=C,L}function dn(n,i,c){var p=c||{},w=p.atBegin,x=w===void 0?!1:w;return cn(n,i,{debounceMode:x!==!1})}var mn=globalThis&&globalThis.__rest||function(n,i){var c={};for(var p in n)Object.prototype.hasOwnProperty.call(n,p)&&i.indexOf(p)<0&&(c[p]=n[p]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var w=0,p=Object.getOwnPropertySymbols(n);w<p.length;w++)i.indexOf(p[w])<0&&Object.prototype.propertyIsEnumerable.call(n,p[w])&&(c[p[w]]=n[p[w]]);return c};let He=null;function un(n,i){const{indicator:c}=i,p=`${n}-dot`;return c===null?null:Ze(c)?ze(c,{className:ye(c.props.className,p)}):Ze(He)?ze(He,{className:ye(He.props.className,p)}):l("span",{className:ye(p,`${n}-dot-spin`),children:[e("i",{className:`${n}-dot-item`}),e("i",{className:`${n}-dot-item`}),e("i",{className:`${n}-dot-item`}),e("i",{className:`${n}-dot-item`})]})}function fn(n,i){return!!n&&!!i&&!isNaN(Number(i))}const pn=n=>{const{spinPrefixCls:i,spinning:c=!0,delay:p=0,className:w,size:x="default",tip:d,wrapperClassName:S,style:O,children:E,hashId:H}=n,D=mn(n,["spinPrefixCls","spinning","delay","className","size","tip","wrapperClassName","style","children","hashId"]),[I,$]=m.exports.useState(()=>c&&!fn(c,p));m.exports.useEffect(()=>{const k=dn(p,()=>{$(c)});return k(),()=>{var T;(T=k==null?void 0:k.cancel)===null||T===void 0||T.call(k)}},[p,c]);const C=m.exports.useMemo(()=>typeof E<"u",[E]),{direction:L}=m.exports.useContext(it),M=ye(i,{[`${i}-sm`]:x==="small",[`${i}-lg`]:x==="large",[`${i}-spinning`]:I,[`${i}-show-text`]:!!d,[`${i}-rtl`]:L==="rtl"},w,H),V=ye(`${i}-container`,{[`${i}-blur`]:I}),r=St(D,["indicator","prefixCls"]),y=l("div",{...Object.assign({},r,{style:O,className:M,"aria-live":"polite","aria-busy":I}),children:[un(i,n),d?e("div",{className:`${i}-text`,children:d}):null]});return C?l("div",{...Object.assign({},r,{className:ye(`${i}-nested-loading`,S,H)}),children:[I&&e("div",{children:y},"loading"),e("div",{className:V,children:E},"container")]}):y},ut=n=>{const{prefixCls:i}=n,{getPrefixCls:c}=m.exports.useContext(it),p=c("spin",i),[w,x]=Zt(p),d=Object.assign(Object.assign({},n),{spinPrefixCls:p,hashId:x});return w(e(pn,{...Object.assign({},d)}))};ut.setDefaultIndicator=n=>{He=n};const hn=ut;function xn(n){const{onLocateClick:i,dateString:c,showTime:p,setShowTime:w}=n,[x,d]=m.exports.useState(!1),S=ve(),O=()=>{d(()=>!x)};return m.exports.useEffect(()=>{p&&setTimeout(()=>{w(!1)},1e3)},[p]),l("div",{className:"flex flex-col items-end fixed z-9 bottom-26 right-5 sm:hidden",children:[l("div",{className:`flex flex-col items-end ${x?"":"hidden"}`,children:[e("div",{className:"flex flex-col",children:l("div",{className:"flex items-center",children:[e("p",{className:"opacity-80 px-2 py-1 rounded-lg mr-4 text-sm text-color-[#ffffff] bg-[#2A4948]",children:"\u6DFB\u52A0\u4F11\u606F\u65F6\u95F4"}),e("div",{onClick:()=>S("/calendar/add/break",{state:{dateString:c}}),className:"flex shadow-sm cursor-pointer justify-center w-[64px] h-[64px] rounded-2xl bg-[#2A4948] items-center",children:e(A,{name:"add-break",className:"w-[25px] h-[30px]",style:{color:"#FFF"}})})]})}),e("div",{className:"flex mt-4 flex-col",children:l("div",{className:"flex items-center",children:[e("p",{className:"opacity-80 px-2 py-1 rounded-lg mr-4 text-sm text-color-[#ffffff] bg-[#2A4948]",children:"\u6DFB\u52A0\u65B0\u9884\u7EA6"}),e("div",{onClick:()=>S("/calendar/add/order",{state:{dateString:c}}),className:"flex cursor-pointer shadow-sm justify-center w-[64px] h-[64px] rounded-2xl bg-[#2A4948] items-center",children:e(A,{name:"add-order",className:"w-[25px] h-[30px]",style:{color:"#FFF"}})})]})})]}),e("div",{className:`flex flex-col relative items-end ${x?"hidden":""}`,children:e("div",{className:"flex flex-col",children:e("div",{className:"flex items-center",children:e("div",{onClick:()=>{w(!0),i()},className:"flex cursor-pointer shadow-sm justify-center w-[64px] h-[64px] rounded-2xl bg-[#FFF] items-center",children:e(A,{name:"locate-now",className:"w-[30px] h-[30px]"})})})})}),e("div",{onClick:O,className:`flex mt-4 shadow-sm cursor-pointer ${x?"bg-[#ffffff]":"bg-[#9ECED2]"}  w-[64px] h-[64px] rounded-2xl items-center justify-center`,children:e(A,{name:`${x?"nav-cancel":"add"}`,className:"w-[23px] h-[23px]",style:{color:x?"#000":"#FFF"}})})]})}const gn="_CalendarTimeLabel_4s0ec_1",yn="_CalendarTimeGrid_4s0ec_8",vn="_FullHourTimeGrid_4s0ec_20",bn="_CalendarEventCard_4s0ec_24",wn="_CalendarEventLabel_4s0ec_30",Cn="_CalendarNoteIcon_4s0ec_36",Nn="_CalendarScheduleItem_4s0ec_41",Sn="_CalendarScheduleLabel_4s0ec_47",Dn="_ModalForm_4s0ec_55",Fn="_swiperItem_4s0ec_86",_n="_swiperItemFull_4s0ec_90",$n="_leftOutlineStyle_4s0ec_94",Mn="_rightOutlineStyle_4s0ec_103",q={CalendarTimeLabel:gn,CalendarTimeGrid:yn,FullHourTimeGrid:vn,CalendarEventCard:bn,CalendarEventLabel:wn,CalendarNoteIcon:Cn,CalendarScheduleItem:Nn,CalendarScheduleLabel:Sn,ModalForm:Dn,swiperItem:Fn,swiperItemFull:_n,leftOutlineStyle:$n,rightOutlineStyle:Mn};function Yn(n){const{onLocateClick:i,dateString:c,setDateString:p,showTime:w,setShowTime:x,setOpen:d}=n,S=ve();m.exports.useEffect(()=>{w&&setTimeout(()=>{x(!1)},1e3)},[w]);const H={items:[{label:"\u6DFB\u52A0\u65B0\u9884\u7EA6",key:"1"},{label:"\u6DFB\u52A0\u65B0\u4F11\u606F\u65F6\u95F4",key:"2"}],onClick:$=>{$.key==="1"&&S("/calendar/add/order",{state:{dateString:c}}),$.key==="2"&&d(!0)}},D="YYYY/MM/DD",I=$=>`${Ft($.unix()*1e3)} ${$.format(D)}`;return l("div",{className:"hidden items-center sm:flex bg-[#ecefef] fixed top-60px w-full z-99 py-4 justify-between",children:[e("div",{className:"flex flex-col pl-8",children:e("div",{className:"flex items-center",children:e("div",{onClick:()=>{x(!0),i()},className:"flex cursor-pointer shadow-sm justify-center w-[40px] h-[40px] rounded-xl bg-[#FFF] items-center",children:e(A,{name:"locate-now",className:"w-[20px] h-[20px]"})})})}),l("div",{className:"flex bg-[#fff] items-center rounded-md px-2",children:[e(Re,{onClick:()=>{const $=N(c).add(-1,"day");p($.format("YYYY/MM/DD"))},className:"cursor-pointer"}),e(qe,{onChange:$=>{p(N($).format("YYYY/MM/DD"))},value:N(c,D),style:{width:180},placeholder:"\u8BF7\u9009\u62E9\u65F6\u95F4",allowClear:!1,format:$=>I($),className:"!bg-[#fff] !rounded-md",bordered:!1}),e(Ae,{onClick:()=>{const $=N(c).add(1,"day");p($.format("YYYY/MM/DD"))},className:"cursor-pointer"})]}),e("div",{className:"flex shadow-sm cursor-pointer mr-92px",children:e(ot,{menu:H,placement:"bottom",children:e(Dt,{type:"primary",children:l(jt,{children:["\u6DFB\u52A0",e(Pt,{})]})})})})]})}const{TextArea:En}=Rt;function kn(n){var V;const{dateString:i="",setOpen:c,employeeId:p,initSubscribeData:w}=n;ve();const x=_t(),d=Te.getState().global.userInfo,[S]=re.useForm(),{runAsync:O}=J(ge.getStaffSelect,{manual:!0}),{run:E,loading:H}=J(r=>ie.getRest(r),{manual:!0,onSuccess(r){var y,k,T,G,U,le;S.setFieldsValue({date:o(((y=r==null?void 0:r.data)==null?void 0:y.start_time)*1e3).toDate(),employee:[`${(k=r==null?void 0:r.data)==null?void 0:k.staff_id}`],startTime:N(((T=r==null?void 0:r.data)==null?void 0:T.start_time)*1e3,"HH:mm"),endTime:N(((G=r==null?void 0:r.data)==null?void 0:G.end_time)*1e3,"HH:mm"),remark:(U=r==null?void 0:r.data)==null?void 0:U.remark,is_subscribe:[`${(le=r==null?void 0:r.data)==null?void 0:le.is_subscribe}`]})}}),D=((V=x==null?void 0:x.state)==null?void 0:V.restId)||"",[I,$]=m.exports.useState([]),[C,L]=m.exports.useState(!1);m.exports.useEffect(()=>{D&&E({id:D})},[D]),m.exports.useEffect(()=>{i&&S.setFieldValue("date",N(i))},[i]),m.exports.useEffect(()=>{if(!D&&S){let r=o().format("H"),y=o().format("mm");y*1===0&&(y="00"),y*1>0&&y*1<=15&&(y=15),y*1>15&&y*1<=30&&(y=30),y*1>30&&y*1<=45&&(y=45),y*1>45&&(y="00",r*1===23?r="0":r=r*1+1);const k=o(i).format("YYYY-MM-DD"),T=o(`${k} ${r}:${y}`).unix(),G=o(T*1e3).add(15,"minutes").format("H"),U=o(T*1e3).add(15,"minutes").format("mm");S.setFieldsValue({startTime:N(`${r}:${y}`,"HH:mm"),endTime:N(`${G}:${U}`,"HH:mm")})}},[S]),m.exports.useEffect(()=>{p&&S.setFieldsValue({employee:p})},[p]),m.exports.useEffect(()=>{(async()=>{if(d&&d.user_type===2){const{data:y}=await O({});y&&y.length&&$(y.map(k=>({label:k.nickname,value:String(k.id)})))}})()},[]);const M=async r=>{if(C)return!1;L(!0);const y=o(r.date).format("YYYY-MM-DD"),k=N(r.startTime).format("H:mm"),T=N(r.endTime).format("H:mm"),G={start_time:o(`${y} ${k}`,"YYYY-MM-DD H:mm").unix(),end_time:o(`${y} ${T}`,"YYYY-MM-DD H:mm").unix(),is_subscribe:r.is_subscribe&&r.is_subscribe?1:0,remark:r.remark||""};let U;D?U=await ie.editRest(d&&d.user_type===2?{id:D,staff_id:Number(r.employee),...G}:{id:D,...G}):U=await ie.restSave(d&&d.user_type===2?{...G,staff_id:Number(r.employee)}:G),U.status===200&&(c(!1),w(),S.resetFields()),L(!1)};return H?e(Vt,{}):e("div",{className:`${xe.AddBreakForm} max-w-[100%] !min-h-3`,children:l("div",{className:"flex flex-col",children:[e("p",{className:"text-xl pb-5 font-600",children:D?"\u7F16\u8F91\u65B0\u4F11\u606F\u65F6\u95F4":"\u6DFB\u52A0\u65B0\u4F11\u606F\u65F6\u95F4"}),l(re,{layout:"vertical",onFinish:M,form:S,children:[e(re.Item,{name:"date",label:"\u65E5\u671F",rules:[{required:!0}],children:e(qe,{placeholder:"\u8BF7\u9009\u62E9\u65E5\u671F",className:"w-full"})}),d&&d.user_type===2?e(re.Item,{name:"employee",label:"\u5458\u5DE5",rules:[{required:!0,message:"\u6B64\u9879\u662F\u5FC5\u586B\u9879"}],children:e(Gt,{options:I,placeholder:"\u8BF7\u9009\u62E9",filterOption:(r,y)=>{var k;return((k=y==null?void 0:y.label)!=null?k:"").toLowerCase().includes(r.toLowerCase())},showSearch:!0})}):null,l("div",{children:[e(re.Item,{name:"startTime",label:"\u5F00\u59CB\u65F6\u95F4",className:xe.halfFormItem,rules:[{required:!0}],children:e(Le,{showNow:!1,minuteStep:15,format:"HH:mm",placeholder:"\u5F00\u59CB\u65F6\u95F4"})}),e(re.Item,{name:"endTime",label:"\u7ED3\u675F\u65F6\u95F4",className:xe.halfFormItem,rules:[{required:!0}],children:e(Le,{showNow:!1,minuteStep:15,format:"HH:mm",placeholder:"\u7ED3\u675F\u65F6\u95F4"})})]}),e(re.Item,{name:"is_subscribe",className:`${xe.noLabelFormItem} ${xe.noBgFormItem}`,children:e(at.Group,{children:e(at,{value:"1",children:"\u4F11\u606F\u65F6\u95F4\u5141\u8BB8\u7EBF\u4E0A\u9884\u7EA6"})})}),e(re.Item,{name:"remark",label:"\u5907\u6CE8",className:xe.area,children:e(En,{placeholder:"\u8F93\u5165"})}),e("div",{className:"flex w-full justify-center",children:e($t,{className:"rounded-3xl",type:"submit",color:"primary",block:!0,loadingIcon:e(qt,{}),loading:"auto",children:"\u4FDD\u5B58"})})]})]})})}function Bn(n){var Xe,Ue,We,Ke,Je,Qe;const{dateString:i,setDateString:c}=n,p=m.exports.useRef(null),w=m.exports.useRef(null),x=ve(),d=Te.getState().global.userInfo,{runAsync:S,loading:O}=J(ge.getStaffSelect,{manual:!0}),{runAsync:E,loading:H,data:D,refresh:I}=J(ie.getMySubscribe,{manual:!0,onSuccess(t){var u,v,f;t.status===203&&et.show({content:`${(u=t==null?void 0:t.data)==null?void 0:u.text}`,closeOnAction:!0,actions:[[{key:"cancel",text:"\u62D2\u7EDD\u5173\u8054",className:"dialog-cancel",onClick(){var P;$({type:2,temp_token:(P=t==null?void 0:t.data)==null?void 0:P.temp_token,is_success:2})}},{key:"confirm",text:"\u7ACB\u5373\u5173\u8054",className:"dialog-confirm",async onClick(){var P;$({type:2,temp_token:(P=t==null?void 0:t.data)==null?void 0:P.temp_token,is_success:1})}}]]}),t.status===202&&et.show({content:`${(v=t==null?void 0:t.data)==null?void 0:v.text}`,closeOnAction:!0,actions:[[{key:"cancel",text:"\u8054\u7CFB\u5BA2\u670D",className:"dialog-cancel",onClick(){window.location.href=`${location.origin}/personal/help`}},{key:"confirm",text:`${(f=t==null?void 0:t.data)==null?void 0:f.title}`,className:"dialog-confirm",async onClick(){var P;Te.dispatch(Mt({stripeInfo:{staff_id:(P=t==null?void 0:t.data)==null?void 0:P.staff_id},type:4})),window.location.href=`${location.origin}/pay`}}]]})}}),{run:$}=J(t=>ge.confirm(t),{manual:!0,onSuccess(){window.location.reload()}}),[C,L]=m.exports.useState(-1),[M,V]=m.exports.useState(null),[r,y]=m.exports.useState([]),[k,T]=m.exports.useState(0),[G,U]=m.exports.useState([]),[le,je]=m.exports.useState([]),[Oe,W]=m.exports.useState(!1),[g,be]=m.exports.useState(null),[we,R]=m.exports.useState(null),[z,Ce]=m.exports.useState(null),[Y,ee]=m.exports.useState({}),[te,B]=m.exports.useState(1),[Ne,$e]=m.exports.useState(!1),[Se,ne]=m.exports.useState(!1),a=ct(document.querySelector("body")),ae=t=>({id:String((t==null?void 0:t.id)||(t==null?void 0:t.user_id)||(t==null?void 0:t.staff_id)),name:t==null?void 0:t.nickname,avatar:t==null?void 0:t.head,online:t==null?void 0:t.online,schedule:t==null?void 0:t.schedule,type:t==null?void 0:t.type}),se=t=>{const u=[];if(M&&M.length){const v=M.find(f=>String(f.staff_id)===t);v&&v.order.length&&u.push(...v.order.map(f=>({id:f.id,start:o.unix(f.start_time).format("HH:mm"),end:o.unix(f.end_time).format("HH:mm"),title:f.server_type===1?"\u5802\u98DF":"\u5916\u5356",name:f.client_name,status:f.server_type,note:f.remark,isNew:f.status===0,source:f.source}))),v&&v.rest.length&&u.push(...v.rest.map(f=>({type:"rest",id:f.id,start:o.unix(f.start_time).format("HH:mm"),end:o.unix(f.end_time).format("HH:mm")}))),v&&v.no_schedule.length&&u.push(...v.no_schedule.map(f=>({start:o.unix(f.start_time).format("HH:mm"),end:o.unix(f.end_time).format("HH:mm"),status:5})))}return u};m.exports.useEffect(()=>{C>=0&&(R(r[C][0].id),U(se(r[C][0].id)),r[C][1]&&Ce(r[C][1].id),je(r[C][1]&&se(r[C][1].id)||[]))},[C]),m.exports.useEffect(()=>{C===-1&&M&&M.length&&r&&r.length&&L(0)},[M,r]);const Me=async()=>{var u;const{data:t}=await E({date:i});(u=p.current)==null||u.swipeTo(0),V(t||null),L(-1)};m.exports.useEffect(()=>{Me()},[i]);const De=async()=>{if(d&&d.user_type===1)y([[ae(D==null?void 0:D.data[0])]]);else if(d&&d.user_type===2){const t=[],{data:u}=await S({});T(u.length);for(let v=0;v<u.length;v+=2){const f=[ae(u[v])];u[v+1]&&f.push(ae(u[v+1])),t.push(f)}y(t)}},oe=async()=>{if(console.log("initPcEmployeeData"),d&&d.user_type===1)y([[ae(D==null?void 0:D.data[0])]]);else if(d&&d.user_type===2){const t=[],{data:u}=await S({});T(u.length),console.log("employeeData",u);for(let v=0;v<u.length/10;v++){const f=u.slice(v*10,(v+1)*10);t.push(f.map(P=>ae(P)))}console.log("doubleList",t),y(t)}};m.exports.useEffect(()=>{D&&((a==null?void 0:a.width)&&(a==null?void 0:a.width)>=640?oe():De())},[d,d.user_type,D]),m.exports.useEffect(()=>{if(r.length&&M.length){const t=[];if(M==null||M.map(u=>{var v;(v=r[C])==null||v.map(f=>{`${u.staff_id}`==`${f.id}`&&u.start_time!==0&&t.push(u.start_time)})}),t.length){const u=on(t),v=o(u*1e3).format("HH:mm"),f=document.getElementById(v);f&&w.current&&window.scrollTo({top:f==null?void 0:f.offsetTop})}else w.current&&window.scrollTo(0,0)}},[C]);const s=async t=>{L(t)},b=()=>{let t=o().format("mm");console.log(t),t*1>=0&&t*1<15&&(t="00"),t*1>=15&&t*1<30&&(t="15"),t*1>=30&&t*1<45&&(t="30"),t*1>=45&&t*1<60&&(t="45");const u=`${o().format("HH")}:${t}`;document.getElementById(u);const v=document.getElementsByClassName(`date${u}`),f=Array.from(v).find(P=>P.offsetTop);f&&w.current&&window.scrollTo(0,(f==null?void 0:f.offsetTop)-200)},F=t=>{x("/calendar/view",{state:{id:t}})},_=(t,u)=>{x("/calendar/add/order",{state:{dateString:i,timeString:t,employeeId:u}})},j=()=>{const t=[],u=o().format("H:mm"),v=o().format("mm"),f=o().format("H"),P=Array.from({length:60},(K,fe)=>fe);for(let K=0;K<=23;K++){let fe="";fe=`${K}:00`,t.push(l("div",{className:`${q.CalendarTimeLabel} flex flex-col items-end text-xs font-600 relative leading-3`,children:[e("span",{children:fe}),f===`${K}`&&(P==null?void 0:P.map(Q=>{if(`${v}`==`${Q<10?"0"+Q:Q}`)return l("div",{style:{top:Q*1.5+"%",opacity:Ne?1:0},className:"absolute flex items-center w-98vw left-2vw z-99 sm:w-[calc(100vw-90px+0.5rem)]",children:[e("span",{id:`now_${f}_${Q}`,className:"border flex justify-center items-center border-solid border-color-[#9e1d1d] rounded-xl px-1 py-2px text-xs text-color-[#9e1d1d] bg-[#fff]",children:u}),e("div",{className:"flex-1 h-2px bg-[#9E1D1D]"})]},Q)}))]},K))}return t},X=(t=[],u)=>{var Q;const v=[],f=M==null?void 0:M.find(h=>String(h.staff_id)===String(u));for(let h=0;h<96;h++){const Ee=h%4===3;let ke=0;const Z=`${Math.floor(h/4)<10?"0"+Math.floor(h/4):Math.floor(h/4)}:${h%4*15===0?"00":h%4*15}`;if(f){const Be=o((f==null?void 0:f.start_time)*1e3).format("YYYY-MM-DD");o((f==null?void 0:f.start_time)*1e3).unix()*1<=o(`${Be} ${Z}`).unix()*1&&o(`${Be} ${Z}`).unix()*1<o((f==null?void 0:f.end_time)*1e3).unix()*1&&(ke=1)}v.push(l("div",{id:`${Z}`,className:`${"date"+Z} ${q.CalendarTimeGrid} ${Ee?q.FullHourTimeGrid:""}
          ${ke?"bg-[#fff]":"bg-[#f1f1f1]"}           
          ${Z===(Y==null?void 0:Y.time)&&u===(Y==null?void 0:Y.id)&&(a==null?void 0:a.width)&&(a==null?void 0:a.width)<640?"bg-[#2a4948] transform shadow-sm flex items-center":""}
          h-[30px]  border-[0.5px] border-solid border-color-[#e1e1e1] cursor-pointer sm:hover:bg-[#e5f2f1]`,onClick:()=>{ee({time:`${Math.floor(h/4)<10?"0"+Math.floor(h/4):Math.floor(h/4)}:${h%4*15===0?"00":h%4*15}`,id:u}),Z===(Y==null?void 0:Y.time)&&u===(Y==null?void 0:Y.id)&&_(`${Math.floor(h/4)}:${h%4*15}`,u)},children:[Z===(Y==null?void 0:Y.time)&&u===(Y==null?void 0:Y.id)&&(a==null?void 0:a.width)&&(a==null?void 0:a.width)<640&&e(A,{style:{color:"#fff"},name:"add",className:"w-10px h-10px absolute left-1"}),(a==null?void 0:a.width)&&(a==null?void 0:a.width)>=640&&e("p",{className:"opacity-0 bg-transparent w-full h-full flex items-center pl-1 sm:hover:opacity-100",children:`${Math.floor(h/4)<10?"0"+Math.floor(h/4):Math.floor(h/4)}:${h%4*15===0?"00":h%4*15}`})]},h))}const P=[],K="YYYY-MM-DD HH:mm",fe=o(`${i} 00:00`,K);for(let h=0;h<t.length;h++){const Ee=o(`${i} ${t[h].start}`,K),ke=o(`${i} ${t[h].end}`,K),Z=Ee.diff(fe,"minutes")/15*30,Be=ke.diff(Ee,"minutes")/15*30,xt=t[h].source===1?"#E1EAE9":t[h].source===2?"#FFEBE3E5":t[h].status===3?"#FFEBE34D":"#F3F3F3",gt=t[h].source===1?"#7AB1B0":"#C25F37",yt=t[h].source===1?"#2A4948":"#3C1E12";P.push(l("div",{className:`${q.CalendarEventCard} ${t[h].status?"z-2":"z-1"} absolute px-4 py-2 text-xs`,style:{top:Z,height:Be,backgroundColor:xt,color:yt},onClick:()=>{if(t[h].status===5)return!1;if(!t[h].status)return x("/calendar/rest/check",{state:{id:t[h].id}});F(t[h].id)},children:[l("div",{className:"font-600 text-right relative",children:[e("span",{className:"top-6 left-0 absolute",children:t[h].name}),e("span",{children:t[h].title})]}),((Q=t[h])==null?void 0:Q.type)==="rest"||t[h].status===5?e("span",{className:"absolute"}):l("span",{className:"-mt-4 absolute",children:[t[h].start,"-",t[h].end]}),t[h].isNew?e("div",{className:`${q.CalendarEventLabel} absolute px-2 text-center text-xs text-color-[#D2693F] bg-[#FFF]`,children:"\u65B0\u9884\u7EA6"}):null,t[h].note?e(Lt,{content:t[h].note,trigger:"click",children:e("span",{className:`${q.CalendarNoteIcon} absolute z-2`,onClick:vt=>{vt.stopPropagation()},children:e(A,{name:"event-note",className:"w-[12px] h-[12px]",style:{color:gt}})})}):null]},96+h))}return[...v,...P]},Ye=[{key:"1",label:l("div",{onClick:async t=>{t.preventDefault();const u=await ge.staffOnline({id:g.id});u.status===200&&(tt.show(u.msg),I(),(a==null?void 0:a.width)&&(a==null?void 0:a.width)>=640?oe():De())},className:"flex items-center border border-solid w-56px rounded-2xl justify-center my-2",children:[e("p",{className:"text-color-[#8c8c8c] text-xs pr-1",children:(g==null?void 0:g.online)===1?"\u4E0A\u7EBF":"\u4E0B\u7EBF"}),e("span",{className:`${(g==null?void 0:g.online)===1?"bg-[#2A4948]":"bg-[#970D0D]"} p-1 rounded-full`})]})},{type:"divider"},{key:"2",label:e("div",{className:"my-2",onClick:t=>{t.preventDefault(),(d==null?void 0:d.user_type)===2&&x("/manage/add/employee/information",{state:{id:g==null?void 0:g.id}}),(d==null?void 0:d.user_type)===1&&x("/personal/information")},children:"\u7F16\u8F91\u8D44\u6599"})},{type:"divider"},{key:"3",label:e("div",{className:"my-2",onClick:t=>{t.preventDefault(),x("/calendar/add/order",{state:{employeeId:g==null?void 0:g.id,dateString:i}})},children:"\u6DFB\u52A0\u65B0\u9884\u7EA6"})},{type:"divider"},{key:"4",label:e("div",{className:"my-2",onClick:t=>{t.preventDefault(),ne(!0)},children:"\u6DFB\u52A0\u65B0\u4F11\u606F\u65F6\u95F4"})},{type:"divider"},{key:"5",label:e("div",{className:"my-2",onClick:t=>{t.preventDefault(),x("/calendar/plan")},children:"\u66F4\u6539\u5DE5\u4F5C\u65F6\u95F4"})}],de=t=>l("div",{onClick:()=>{be(t[0]),(a==null?void 0:a.width)&&(a==null?void 0:a.width)<640&&W(!0)},className:`flex flex-col h-full justify-center items-center sm:hover:bg-[#f9fcfb] ${t.length===1?q.swiperItemFull:q.swiperItem}`,children:[e("div",{className:"flex items-center justify-center w-[45px] h-[45px] border-[1.5px] border-solid border-color-[#C8E3E2] rounded-full overflow-hidden",children:t[0].avatar?e("img",{className:"w-[39px] h-[39px] rounded-full",style:{objectFit:"cover"},src:t[0].avatar}):e("div",{className:"flex items-center justify-center w-[39px] h-[39px] bg-[#C8E3E24D] rounded-full text-lg text-color-[#C8E3E2]",children:t[0].name[0].toUpperCase()})}),e("span",{className:"text-xs font-600 mt-1.5",children:t[0].name})]}),me=t=>l("div",{onClick:()=>{be(t[1]),(a==null?void 0:a.width)&&(a==null?void 0:a.width)<640&&W(!0)},className:"flex flex-col h-full justify-center items-center w-[50%] sm:hover:bg-[#f9fcfb]",children:[e("div",{className:"flex items-center justify-center w-[45px] h-[45px] border-[1.5px] border-solid border-color-[#C8E3E2] rounded-full",children:t[1].avatar?e("img",{className:"w-[39px] h-[39px] rounded-full",style:{objectFit:"cover"},src:t[1].avatar}):e("div",{className:"flex items-center justify-center w-[39px] h-[39px] bg-[#C8E3E24D] rounded-full text-lg text-color-[#C8E3E2]",children:t[1].name[0].toUpperCase()})}),e("span",{className:"text-xs font-600 mt-1.5",children:t[1].name})]},Math.random()),ue=t=>l("div",{onClick:()=>{be(t),(a==null?void 0:a.width)&&(a==null?void 0:a.width)<640&&W(!0)},className:`flex flex-col h-full justify-center items-center sm:hover:bg-[#f9fcfb] ${q.swiperItem}`,children:[e("div",{className:"flex items-center justify-center w-[45px] h-[45px] border-[1.5px] border-solid border-color-[#C8E3E2] rounded-full overflow-hidden",children:t.avatar?e("img",{className:"w-[39px] h-[39px] rounded-full",style:{objectFit:"cover"},src:t.avatar}):e("div",{className:"flex items-center justify-center w-[39px] h-[39px] bg-[#C8E3E24D] rounded-full text-lg text-color-[#C8E3E2]",children:t.name[0].toUpperCase()})}),e("span",{className:"text-xs font-600 mt-1.5",children:t.name})]}),ft=()=>l(ce,{children:[e(Re,{onClick:ht,className:`${q.leftOutlineStyle} top-[30px] sm:top-[102px]`}),e(Ae,{onClick:pt,className:`${q.rightOutlineStyle} top-[30px] sm:top-[102px]`})]}),pt=t=>{var u;t.stopPropagation(),(u=p.current)==null||u.swipeNext()},ht=t=>{var u;t.stopPropagation(),(u=p.current)==null||u.swipePrev()};return l("div",{className:"relative",children:[e(xn,{dateString:i,onLocateClick:b,setShowTime:$e,showTime:Ne}),e(Yn,{dateString:i,setDateString:c,onLocateClick:b,setShowTime:$e,showTime:Ne,setOpen:ne}),l(hn,{spinning:H,children:[l("div",{className:"w-[100%] <sm:shadow-sm fixed z-9 bg-[#FFF] sm:pt-75px relative",children:[r.length===0&&!H&&!O&&e("div",{className:"<sm:hidden flex items-center justify-center h-22",children:l("div",{onClick:()=>x("/manage/add/employee"),className:"h-50px bg-[#f4f6f6] rounded-lg flex items-center px-4 cursor-pointer",children:[e("div",{className:"w-34px h-34px rounded-full bg-[#cdd3d3] flex justify-center items-center",children:e(A,{name:"add-new",className:"w-12px h-16px",style:{color:"#fff"}})}),e("div",{className:"px-2",children:"\u5F00\u59CB\u6DFB\u52A0\u65B0\u7684\u5458\u5DE5\u5427\uFF01"}),e(Ae,{})]})}),k>=10&&(a==null?void 0:a.width)&&(a==null?void 0:a.width)>=640?ft():null,e(pe,{ref:p,className:"flex-shrink-0 w-auto sm:ml-16",indicator:()=>e(ce,{}),onIndexChange:s,children:r.map((t,u)=>e(pe.Item,{children:l("div",{className:"flex items-center h-[90px] justify-center",id:"swiper-first",children:[(a==null?void 0:a.width)&&(a==null?void 0:a.width)<640&&de(t),t.length>1&&(a==null?void 0:a.width)&&(a==null?void 0:a.width)<640?me(t):null,(a==null?void 0:a.width)&&(a==null?void 0:a.width)>=640&&t.map(v=>e(ot,{menu:{items:Ye},overlayStyle:{minWidth:164},trigger:["click"],placement:"bottom",children:ue(v)},Math.random()))]})},u))})]}),l("div",{className:"flex pb-[90px] sm:overflow-x-hidden",ref:w,id:"reserve",children:[e("div",{className:"flex flex-col flex-shrink-0 w-[64px] pr-2",children:j()}),l(pe,{loop:!0,indicator:()=>e(ce,{}),onIndexChange:t=>{if(B(t),t===2&&te===1||t===1&&te===0||t===0&&te===2){const u=o(i).add(1,"days").format("YYYY-MM-DD");c(N(u).format("YYYY-MM-DD"))}if(t===1&&te===2||t===2&&te===0||t===0&&te===1){const u=o(i).add(-1,"days").format("YYYY-MM-DD");c(N(u).format("YYYY-MM-DD"))}},defaultIndex:1,children:[l(pe.Item,{children:[l("div",{className:"flex w-full sm:hidden",children:[e("div",{className:"flex-grow relative z-1",children:X(G,we)}),((Xe=r[C])==null?void 0:Xe.length)>1&&e("div",{className:"flex-grow relative",children:X(le,z)})]}),e("div",{className:"flex w-full <sm:hidden",children:(Ue=r[C])==null?void 0:Ue.map(t=>e("div",{className:"flex-grow relative z-1",children:X(se(t.id),t.id)},Math.random()))})]},0),l(pe.Item,{children:[l("div",{className:"flex w-full sm:hidden",children:[e("div",{className:"flex-grow relative z-1",children:X(G,we)}),((We=r[C])==null?void 0:We.length)>1&&e("div",{className:"flex-grow relative",children:X(le,z)})]}),e("div",{className:"flex w-full <sm:hidden",children:(Ke=r[C])==null?void 0:Ke.map(t=>e("div",{className:"flex-grow relative z-1",children:X(se(t.id),t.id)},Math.random()))})]},1),l(pe.Item,{children:[l("div",{className:"flex w-full sm:hidden",children:[e("div",{className:"flex-grow relative z-1",children:X(G,we)}),((Je=r[C])==null?void 0:Je.length)>1&&e("div",{className:"flex-grow relative",children:X(le,z)})]}),e("div",{className:"flex w-full <sm:hidden",children:(Qe=r[C])==null?void 0:Qe.map(t=>e("div",{className:"flex-grow relative z-1",children:X(se(t.id),t.id)},Math.random()))})]},2)]})]})]}),e(It,{actions:[{text:l("div",{className:"flex flex-col justify-center items-center",children:[e(Yt,{name:g==null?void 0:g.name,headurl:g==null?void 0:g.avatar,sx:{width:52,height:52}}),e("p",{className:"text-xs py-1",children:g==null?void 0:g.name}),((g==null?void 0:g.type)===1||(d==null?void 0:d.user_type)===1)&&l("div",{onClick:async()=>{const t=await ge.staffOnline({id:g.id});t.status===200&&(tt.show(t.msg),W(!1),I(),(a==null?void 0:a.width)&&(a==null?void 0:a.width)>=640?oe():De())},className:"flex border border-solid px-1 justify-center items-center bg-[#fff] rounded-xl",children:[e("p",{className:"text-color-[#8c8c8c] text-xs pr-1",children:(g==null?void 0:g.online)===1?"\u4E0A\u7EBF":"\u4E0B\u7EBF"}),e("span",{className:`${(g==null?void 0:g.online)===1?"bg-[#2A4948]":"bg-[#970D0D]"} p-1 rounded-full`})]})]}),key:"info"},{text:"\u7F16\u8F91\u8D44\u6599",key:"view",onClick:()=>{W(!1),(d==null?void 0:d.user_type)===2&&x("/manage/add/employee/information",{state:{id:g==null?void 0:g.id}}),(d==null?void 0:d.user_type)===1&&x("/personal/information")}},{text:"\u6DFB\u52A0\u65B0\u9884\u7EA6",key:"add",onClick:()=>{W(!1),x("/calendar/add/order",{state:{employeeId:g==null?void 0:g.id,dateString:i}})}},{text:"\u6DFB\u52A0\u65B0\u4F11\u606F\u65F6\u95F4",key:"add-time",onClick:()=>{W(!1),(a==null?void 0:a.width)&&(a==null?void 0:a.width)>640?ne(!0):x("/calendar/add/break",{state:{dateString:i,employeeId:g==null?void 0:g.id}})}},{text:"\u66F4\u6539\u5DE5\u4F5C\u65F6\u95F4",key:"add-work-time",onClick:()=>{W(!1),x("/calendar/plan")}}],visible:Oe,setVisible:W}),e(Ot,{open:Se,width:365,footer:null,onCancel:()=>ne(!1),children:e(kn,{dateString:i,setOpen:ne,employeeId:g==null?void 0:g.id,initSubscribeData:Me,open:Se})})]})}function Hn(n,i){return n>i}var Tn=Hn,An=mt,Ln=Tn,jn=rt;function On(n){return n&&n.length?An(n,jn,Ln):void 0}var In=On;const Pn={},Vn=n=>e("div",{className:Pn.HiilpModal,children:e(dt,{...n})});let Fe=o().format("YYYY/MM/DD"),Ve=0,_e=0;const{RangePicker:Gn}=qe;function Rn(){const n=ve(),[i]=he.useForm(),c=Te.getState().global.userInfo,{runAsync:p}=J(ge.getStaffSelect,{manual:!0}),{runAsync:w}=J(ie.scheduleList,{manual:!0}),{runAsync:x}=J(ie.saveSchedule,{manual:!0,onSuccess(){E(!1),Y(1),L([]),i.resetFields()}}),{runAsync:d}=J(ie.editSchedule,{manual:!0,onSuccess(){Y(1),L([]),E(!1)}}),{runAsync:S}=J(ie.deleteSchedule,{manual:!0,onSuccess(){Y(1),E(!1),L([])}}),[O,E]=m.exports.useState(!1),[H,D]=m.exports.useState(!1),[I,$]=m.exports.useState(!1),[C,L]=m.exports.useState([]),[M,V]=m.exports.useState([]),[r,y]=m.exports.useState("0"),[k]=m.exports.useState(()=>{const s=[],b=[];for(let F=0;F<60;F++){if(F<24){const j=String(F);s.push({label:j,value:j})}const _=F<10?`0${F}`:String(F);b.push({label:_,value:_})}return[s,b]}),[T,G]=m.exports.useState(!0),[U,le]=m.exports.useState("0"),[je,Oe]=m.exports.useState(""),[W,g]=m.exports.useState([]),[be,we]=m.exports.useState(null),[R,z]=m.exports.useState([o().format("YYYY/MM/DD"),o().add(6,"days").format("YYYY/MM/DD")]),[Ce,Y]=Xt(1),[ee,te]=m.exports.useState(1),B=ct(document.querySelector("body")),Ne=async()=>{await S({id:_e})},$e=async s=>{const b=(B==null?void 0:B.width)>=640?N(`${Fe} ${N(s.start_time).format("H:mm")}`).unix():o(`${Fe} ${s.start_time[0]}:${s.start_time[1]}`,"YYYY/MM/DD H:mm").unix(),F=(B==null?void 0:B.width)>=640?N(`${Fe} ${N(s.end_time).format("H:mm")}`).unix():o(`${Fe} ${s.end_time[0]}:${s.end_time[1]}`,"YYYY/MM/DD H:mm").unix();_e?await d({staff_id:Ve,id:_e,start_time:b,end_time:F}):await x({staff_id:Ve,start_time:b,end_time:F})},Se=(s,b)=>{b.current&&b.current.open()},ne=(s,b,F)=>{let _={start_time:[],end_time:[]};const j=[{text:"\u53D6\u6D88",key:"cancel",onClick:()=>{E(!1)}},{text:"\u4FDD\u5B58",key:"save",primary:!0,onClick:()=>{i.submit()}}];if(F){const Ye=C.find(ue=>String(ue.id)===String(s)).children[b],de=o.unix(Ye[0].start_time),me=o.unix(Ye[0].end_time);_={start_time:[de.format("H"),de.format("mm")],end_time:[me.format("H"),me.format("mm")]},(B==null?void 0:B.width)>640&&(_={start_time:N(`${de.format("H")}:${de.format("mm")}`,"H:mm"),end_time:N(`${me.format("H")}:${me.format("mm")}`,"H:mm")}),j.unshift({text:"\u5220\u9664",key:"delete",danger:!0,onClick:()=>{const ue=dt.show({content:e("span",{className:"text-base font-600",children:"\u786E\u8BA4\u5220\u9664\u6B64\u6392\u73ED"}),actions:[{text:"\u53D6\u6D88",key:"cancel_delete",onClick:()=>{ue.close()}},{text:"\u786E\u8BA4",key:"confirm_delete",primary:!0,onClick:async()=>{await Ne(),ue.close(),E(!1)}}]})}})}else _={start_time:[o().format("H"),o().format("mm")],end_time:[o().format("H"),o(o().unix()*1e3).add(1,"minutes").format("mm")]},(B==null?void 0:B.width)>640&&(_={start_time:N(`${o().format("H")}:${o().format("mm")}`,"H:mm"),end_time:N(`${o().format("H")}:${o(o().unix()*1e3).add(1,"minutes").format("mm")}`,"H:mm")});i.setFieldsValue(_),we(e(he,{className:q.ModalForm,requiredMarkStyle:"none",layout:"horizontal",form:i,onFinish:$e,children:l("div",{className:"flex w-[100%]",children:[l("div",{className:"flex flex-col w-[50%] pr-1",children:[e("span",{className:"text-xs font-600 pl-1 pb-1",children:"\u5F00\u59CB\u65F6\u95F4"}),(B==null?void 0:B.width)>=640?e(he.Item,{name:"start_time",rules:[{required:!0}],children:e(Le,{size:"small",defaultValue:N("12:08","H:mm"),format:"H:mm"})}):e(he.Item,{name:"start_time",trigger:"onConfirm",rules:[{required:!0}],onClick:Se,children:e(Ie,{columns:k,children:X=>e(Pe,{val:X,textType:"time"})})})]}),l("div",{className:"flex flex-col w-[50%] pl-1",children:[e("span",{className:"text-xs font-600 pl-1 pb-1",children:"\u7ED3\u675F\u65F6\u95F4"}),(B==null?void 0:B.width)>=640?e(he.Item,{name:"end_time",rules:[{required:!0}],children:e(Le,{size:"small",defaultValue:N("12:08","H:mm"),format:"H:mm"})}):e(he.Item,{name:"end_time",trigger:"onConfirm",rules:[{required:!0}],onClick:Se,children:e(Ie,{columns:k,children:X=>e(Pe,{val:X,textType:"time"})})})]})]})})),g(j),Oe(F?"\u7F16\u8F91\u6392\u73ED":"\u6DFB\u52A0\u6392\u73ED"),E(!0)},a=(s,b,F)=>{Ve=s,Fe=o(R[0],"YYYY/MM/DD").add(b,"days").format("YYYY/MM/DD"),F?(_e=F,ne(s,b,F)):(_e=0,ne(s,b,F))},ae=s=>{(c==null?void 0:c.user_type)===2&&n("/manage/employee/info",{state:{id:s}}),(c==null?void 0:c.user_type)===1&&n("/personal/information")},se=s=>({value:String(s.staff_id||s.user_id||(s==null?void 0:s.id)),label:s.nickname,avatar:s.head||""}),Me=()=>{const s=["\u5458\u5DE5"];let b=o(R[0],"YYYY/MM/DD");const F=o(R[1],"YYYY/MM/DD");for(;b.isSameOrBefore(F);)s.push(b.format("dddd YYYY/MM/DD")),b=b.add(1,"day");return s.map((_,j)=>e("div",{className:`${q.CalendarScheduleItem} flex flex-shrink-0 items-center justify-center bg-[#fff] sm:border sm:border-solid sm:border-color-[#e9e9e9] sm:border-r-0 sm:border-l-0 sm:py-3`,style:{width:j===0?ee*18<120?120:ee*18:145,borderLeft:j===0?"1px solid #e9e9e9":"none"},children:_},j))},De=(s,b)=>{const F=l("div",{className:"flex flex-col",children:[l("div",{className:"flex items-center",children:[e("p",{className:"w-100px text-color-[#2A4948] opacity-80",children:s==null?void 0:s.nickname}),e(A,{name:"online",className:"w-[24px] h-[15px] ml-[6px] flex-shrink-0",style:{visibility:s.isOnline?"visible":"hidden"}})]}),l("div",{children:[e("p",{children:(s==null?void 0:s.email)||"--"}),e("p",{children:(s==null?void 0:s.phone)||"--"})]})]});return l("div",{className:"flex",children:[(B==null?void 0:B.width)>=640?e(Bt,{content:F,placement:"rightTop",children:l("div",{className:`${q.CalendarScheduleItem} flex cursor-pointer flex-shrink-0 items-center justify-center px-[6px] sm:border sm:border-solid sm:border-color-[#e9e9e9] sm:border-r-0 sm:border-t-0 sm:border-b-0 sm:py-3`,style:{width:ee*18<120?120:ee*18},onClick:()=>{ae(s.id)},children:[e("div",{className:"flex flex-shrink-0 items-center justify-center w-[22px] h-[22px] border-[1.5px] border-solid border-color-[#C8E3E2] rounded-full",children:s.head?e("img",{className:"w-[19px] h-[19px] rounded-full",style:{objectFit:"cover"},src:s.head}):e("div",{className:"flex items-center justify-center w-[19px] h-[19px] bg-[#C8E3E24D] rounded-full text-sm text-color-[#C8E3E2]",children:nt(s==null?void 0:s.nickname).children})}),e("span",{className:"ml-[6px] text-left flex-grow sm:text-16px",children:s.nickname}),e(A,{name:"online",className:"w-[24px] h-[15px] ml-[6px] flex-shrink-0",style:{visibility:s.isOnline?"visible":"hidden"}})]})}):l("div",{className:`${q.CalendarScheduleItem} flex cursor-pointer flex-shrink-0 items-center justify-center px-[6px] sm:border sm:border-solid sm:border-color-[#e9e9e9] sm:border-r-0 sm:border-t-0 sm:border-b-0 sm:py-3`,style:{width:ee*18<120?120:ee*18},onClick:()=>{ae(s.id)},children:[e("div",{className:"flex flex-shrink-0 items-center justify-center w-[22px] h-[22px] border-[1.5px] border-solid border-color-[#C8E3E2] rounded-full",children:s.head?e("img",{className:"w-[19px] h-[19px] rounded-full",style:{objectFit:"cover"},src:s.head}):e("div",{className:"flex items-center justify-center w-[19px] h-[19px] bg-[#C8E3E24D] rounded-full text-sm text-color-[#C8E3E2]",children:nt(s==null?void 0:s.nickname).children})}),e("span",{className:"ml-[6px] text-left flex-grow sm:text-16px",children:s.nickname}),e(A,{name:"online",className:"w-[24px] h-[15px] ml-[6px] flex-shrink-0",style:{visibility:s.isOnline?"visible":"hidden"}})]}),s.children.map((_,j)=>e("div",{className:`${q.CalendarScheduleItem} cursor-pointer flex flex-col flex-shrink-0 justify-center`,style:{width:145},onClick:()=>{a(s.id,j,_&&_[0]?_[0].id:0)},children:_&&_[0]?l("div",{className:`${q.CalendarScheduleLabel} sm:min-h-36px !sm:leading-9`,children:[o.unix(_[0].start_time).format("H:mm"),"-",o.unix(_[0].end_time).format("H:mm")]}):null},j))]},b)},oe=async()=>{var F;const s=[],b=await w({start_time:o(R[0],"YYYY/MM/DD").unix(),end_time:o(R[1],"YYYY/MM/DD").unix(),staff_id:r,page:Ce});b&&b.data.data&&((F=b==null?void 0:b.data)==null||F.data.map(_=>{const{list:j=[]}=_;s.push({..._,isOnline:_.online===1,children:j.map(X=>X.schedule)})})),Y(_=>_+1),L(C.concat(s)),G(b.data.data.length>0)};return Et(()=>{L([]),oe()},[U,R,r]),m.exports.useEffect(()=>{Ce===1&&C.length===0&&oe()},[Ce,C.length]),m.exports.useEffect(()=>{(async()=>{const b=[{label:"\u5168\u90E8\u5458\u5DE5",value:"0"}];if(c&&c.user_type===1)V([...b,se(c)]);else if(c&&c.user_type===2){const{data:F}=await p({}),_=[];Ht(F,function(j){_.push(j.nickname.length)}),te(In(_)),V(b.concat(F.map(j=>se(j))))}})()},[c,c.user_type]),l("div",{className:"min-w-[100%] bg-[#FFF] pb-[90px] relative sm:flex sm:flex-col sm:justify-center sm:items-center sm:pb-0",children:[l("div",{className:"w-[100%] bg-[#FFF] shadow-sm pt-4 pb-8 px-12 fixed z-9 sm:hidden",children:[e("div",{className:"bg-[#2A49480D] rounded-[10px] px-6 mb-4 h-10 flex flex-col justify-center text-xs",onClick:()=>{D(!0)},children:e(Ie,{columns:[M],value:[r],visible:H,onConfirm:s=>{Y(1),y(s[0]),L([])},onClose:()=>{D(!1)},children:s=>e(Pe,{val:s,textType:"normal"})})}),l("div",{className:"bg-[#2A49480D] rounded-[10px] px-6 h-10 flex items-center justify-between text-xs",onClick:()=>{$(!0)},children:[e(A,{name:"verify-right",className:"w-[6px] h-[12px] transform rotate-z-180"}),l("span",{className:"text-xs",children:[R[0],"-",R[1]]}),e(A,{name:"verify-right",className:"w-[6px] h-[12px]"})]})]}),l("div",{className:"sm:mt-124px",children:[e("div",{className:"sm:py-2 sm:flex sm:justify-end",children:l("div",{className:"flex items-center bg-[#fff] shadow-sm rounded-md px-2",children:[e(Re,{onClick:()=>{const s=[N(R[0]).add(-6,"day").format("YYYY/MM/DD"),N(R[0]).format("YYYY/MM/DD")];Y(1),z(s)},className:"cursor-pointer"}),e(Gn,{placeholder:["\u5F00\u59CB\u65F6\u95F4","\u7ED3\u675F\u65F6\u95F4"],value:[N(R[0]),N(R[1])],onChange:s=>{s&&(Y(1),z([N(s[0]).format("YYYY/MM/DD"),N(s[1]).format("YYYY/MM/DD")]))},bordered:!1,size:"large"}),e(Ae,{onClick:()=>{const s=[N(R[1]).format("YYYY/MM/DD"),N(R[1]).add(6,"day").format("YYYY/MM/DD")];Y(1),z(s)},className:"cursor-pointer"})]})}),l("div",{className:"min-w-[100%] pt-[144px] max-h-[85vh] overflow-scroll sm:min-w-0 sm:pt-0 sm:overflow-x-scroll sm:max-w-1000px sm:relative",children:[e("div",{className:"flex text-xs font-600 sticky top-0 bg-[#fff]",children:Me()}),M&&M.length?l("div",{className:"flex flex-col text-xs",children:[C.map((s,b)=>De(s,b)),e(kt,{loadMore:oe,hasMore:T})]}):null]})]}),e(Ge,{visible:I,onMaskClick:()=>$(!1),bodyStyle:{height:"auto"},children:e(lt,{value:R,selectionMode:"range",nextYearButton:e(ce,{}),prevYearButton:e(ce,{}),nextMonthButton:e("div",{className:"flex justify-center items-center rounded-lg py-1 px-3 border border-solid border-color-[#ccc]",children:e(A,{name:"verify-right",className:"w-[8px] h-[12px] !transform !rotate-0"})}),prevMonthButton:e("div",{className:"flex justify-center items-center rounded-lg py-1 px-3 border border-solid border-color-[#ccc]",children:e(A,{name:"verify-right",className:"w-[8px] h-[12px] transform rotate-z-180"})}),weekStartsOn:"Monday",onChange:s=>{Y(1),z([o(s[0]).format("YYYY/MM/DD"),o(s[1]).format("YYYY/MM/DD")])}})}),e(Vn,{visible:O,showCloseButton:!0,onClose:()=>{E(!1)},title:je,content:be,actions:W})]})}function Ia(){const[n,i]=m.exports.useState(new Date),[c,p]=m.exports.useState("reserve"),[w,x]=m.exports.useState(!1),[d,S]=m.exports.useState(!1),O=ve(),E=Tt(),H=(E==null?void 0:E.mode)||"reserve";m.exports.useEffect(()=>{H&&p(H)},[H]);const D=V=>{i(o(V,"YYYY-MM-DD").toDate())},I=()=>{x(!0)},$=()=>{O("/calendar/kanban")},C=()=>{S(!0)},L=()=>e(A,{name:"calendar-more",className:"w-[28px] h-[28px]",style:{color:"#2A4948"},onClick:I}),M=()=>e(A,{name:"calendar-order",className:"w-[20px] h-[20px]",style:{color:"#2A4948"},onClick:$});return l("div",{className:`${Wt.calendar} pt-[48px] sm:pt-0`,children:[e("div",{className:"sm:hidden",children:e(At,{title:c==="reserve"?o(n,"YYYY-MM-DD").format("dddd YYYY-MM-DD"):"\u6392\u73ED\u65E5\u5386",renderLeft:L(),renderRight:M(),onTitleClick:c==="reserve"?C:null})}),e("div",{children:c==="reserve"?e(Bn,{dateString:o(n).format("YYYY-MM-DD"),setDateString:D}):c==="plan"?e(Rn,{}):null}),e(Ge,{visible:w,onMaskClick:()=>{x(!1)},bodyStyle:{height:"20.87rem",borderRadius:"20px 20px 0 0"},children:l("div",{className:"w-full h-full flex flex-col items-center px-4",children:[e("p",{className:"w-13 m-4 h-2 bg-[#D9D9D9] rounded-xl"}),e("span",{className:"text-xl font-500 mb-10 mt-8",children:"\u65E5\u5386\u9009\u62E9"}),l("div",{className:"w-full flex justify-around",children:[l("div",{className:"text-center",children:[e(A,{name:`calendar-reserve${c==="reserve"?"-active":""}`,className:"w-[90px] h-[150px]",onClick:()=>{O("/calendar",{replace:!0}),x(!1)}}),e("span",{className:`text-sm ${c!=="reserve"?"text-color-[#B4B4B4]":""}`,children:"\u9884\u7EA6\u65E5\u5386"})]}),l("div",{className:"text-center",children:[e(A,{name:`calendar-plan${c==="plan"?"-active":""}`,className:"w-[90px] h-[150px]",onClick:()=>{O("/calendar/plan",{replace:!0}),x(!1)}}),e("span",{className:`text-sm ${c!=="plan"?"text-color-[#B4B4B4]":""}`,children:"\u6392\u73ED\u65E5\u5386"})]})]})]})}),e(Ge,{visible:d,onMaskClick:()=>S(!1),bodyStyle:{height:"auto"},children:e(lt,{value:n,selectionMode:"single",nextYearButton:e(ce,{}),prevYearButton:e(ce,{}),nextMonthButton:e("div",{className:"flex justify-center items-center rounded-lg py-1 px-3 border border-solid border-color-[#ccc]",children:e(A,{name:"verify-right",className:"w-[8px] h-[12px] !transform !rotate-0"})}),prevMonthButton:e("div",{className:"flex justify-center items-center rounded-lg py-1 px-3 border border-solid border-color-[#ccc]",children:e(A,{name:"verify-right",className:"w-[8px] h-[12px] transform rotate-z-180"})}),weekStartsOn:"Monday",onChange:V=>{i(V),S(!1)}})})]})}export{Ia as default};
