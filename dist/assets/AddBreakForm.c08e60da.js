import{u as L,i as V,s as R,k as B,r as d,a0 as i,b as a,j as h,B as j,aF as g}from"./index.5670e6e0.js";import{F as l}from"./index.11c9b67d.js";import{C as N}from"./index.88567fed.js";import{T as z}from"./index.21b1b6fd.js";import{P as _}from"./index.77a6b2f7.js";import{D as G}from"./index.1dc54ea5.js";import{S as J}from"./Skeleton.c599669d.js";import{H as K}from"./index.04556cd2.js";import{P as y}from"./PickerContent.7accd0df.js";import{M as O}from"./manage.653bb3f0.js";import{s as u}from"./index.module.f30b2635.js";import{E as Q}from"./index.1c39e7a0.js";/* empty css                    *//* empty css                 */import"./is-node-with-content.f661b98b.js";import"./interopRequireDefault.fc5525a1.js";import"./dev-log.6e115cc9.js";import"./index.31244c45.js";import"./index.cb878f88.js";import"./convert-px.daab3cc2.js";import"./native-input.0c0515ca.js";import"./index.c6660251.js";import"./use-gesture-react.esm.346ddc85.js";import"./rubberband.c88fa690.js";import"./bound.bddb6539.js";import"./dayjs.min.37299693.js";import"./isoWeek.f8ad8697.js";function De(){var E,I,$;const M=L(),o=V(),n=R.getState().global.userInfo,[c]=l.useForm(),{runAsync:A}=B(O.getStaffSelect,{manual:!0}),{run:v,loading:H}=B(e=>g.getRest(e),{manual:!0,onSuccess(e){var t,r,m,F,b,S,T,Y;c.setFieldsValue({date:i(((t=e==null?void 0:e.data)==null?void 0:t.start_time)*1e3).toDate(),employee:[`${(r=e==null?void 0:e.data)==null?void 0:r.staff_id}`],startTime:[i(((m=e==null?void 0:e.data)==null?void 0:m.start_time)*1e3).format("H"),i(((F=e==null?void 0:e.data)==null?void 0:F.start_time)*1e3).format("mm")],endTime:[i(((b=e==null?void 0:e.data)==null?void 0:b.end_time)*1e3).format("H"),i(((S=e==null?void 0:e.data)==null?void 0:S.end_time)*1e3).format("mm")],remark:(T=e==null?void 0:e.data)==null?void 0:T.remark,is_subscribe:[`${(Y=e==null?void 0:e.data)==null?void 0:Y.is_subscribe}`]})}}),f=((E=o==null?void 0:o.state)==null?void 0:E.dateString)||"",x=((I=o==null?void 0:o.state)==null?void 0:I.employeeId)||"",s=(($=o==null?void 0:o.state)==null?void 0:$.restId)||"",[k]=d.exports.useState(()=>{const e=[],t=[];for(let r=0;r<60;r++)if(r<24){const m=String(r);e.push({label:m,value:m})}return t.push({label:"00",value:"00"},{label:"15",value:"15"},{label:"30",value:"30"},{label:"45",value:"45"}),[e,t]}),[P,q]=d.exports.useState([]),[D,C]=d.exports.useState(!1);d.exports.useEffect(()=>{s&&v({id:s})},[s]),d.exports.useEffect(()=>{f&&c.setFieldValue("date",i(f).toDate())},[f]),d.exports.useEffect(()=>{if(!s&&c){let e=i().format("H"),t=i().format("mm");t*1===0&&(t="00"),t*1>0&&t*1<=15&&(t=15),t*1>15&&t*1<=30&&(t=30),t*1>30&&t*1<=45&&(t=45),t*1>45&&(t="00",e*1===23?e="0":e=e*1+1);const r=i(f).format("YYYY-MM-DD"),m=i(`${r} ${e}:${t}`).unix(),F=i(m*1e3).add(15,"minutes").format("H"),b=i(m*1e3).add(15,"minutes").format("mm");c.setFieldsValue({startTime:[`${e}`,`${t}`],endTime:[`${F}`,`${b}`]})}},[c]),d.exports.useEffect(()=>{x&&c.setFieldsValue({employee:[x]})},[x]),d.exports.useEffect(()=>{(async()=>{if(n&&n.user_type===2){const{data:t}=await A({});t&&t.length&&q(t.map(r=>({label:r.nickname,value:String(r.id)})))}})()},[]);const w=async e=>{if(D)return!1;C(!0);const t=i(e.date).format("YYYY-MM-DD"),r={start_time:i(`${t} ${e.startTime[0]}:${e.startTime[1]}`,"YYYY-MM-DD H:mm").unix(),end_time:i(`${t} ${e.endTime[0]}:${e.endTime[1]}`,"YYYY-MM-DD H:mm").unix(),is_subscribe:e.is_subscribe&&e.is_subscribe[0]?1:0,remark:e.remark||""};let m;s?m=await g.editRest(n&&n.user_type===2?{id:s,staff_id:Number(e.employee[0]),...r}:{id:s,...r}):m=await g.restSave(n&&n.user_type===2?{...r,staff_id:Number(e.employee[0])}:r),m.status===200&&M("/calendar",{replace:!0}),C(!1)},p=(e,t)=>{t.current&&t.current.open()};return H?a(J,{}):h("div",{className:`${u.AddBreakForm} pt-[48px] pb-[90px]`,children:[a(K,{renderLeft:!1}),h("div",{className:"flex flex-col px-10 py-12",children:[a("p",{className:"text-2xl font-600 pb-10",children:s?"\u7F16\u8F91\u65B0\u4F11\u606F\u65F6\u95F4":"\u6DFB\u52A0\u65B0\u4F11\u606F\u65F6\u95F4"}),h(l,{requiredMarkStyle:"none",layout:"horizontal",onFinish:w,footer:null,form:c,children:[a(l.Item,{name:"date",label:"\u65E5\u671F",rules:[{required:!0}],trigger:"onConfirm",onClick:p,children:a(G,{children:e=>a(y,{val:e,textType:"date"})})}),n&&n.user_type===2?a(l.Item,{name:"employee",label:"\u5458\u5DE5",rules:[{required:!0}],trigger:"onConfirm",onClick:p,children:a(_,{columns:[P],children:e=>a(y,{val:e,textType:"normal"})})}):null,h("div",{children:[a(l.Item,{name:"startTime",label:"\u5F00\u59CB\u65F6\u95F4",className:u.halfFormItem,rules:[{required:!0}],trigger:"onConfirm",onClick:p,children:a(_,{columns:k,children:e=>a(y,{val:e,textType:"time"})})}),a(l.Item,{name:"endTime",label:"\u7ED3\u675F\u65F6\u95F4",className:u.halfFormItem,rules:[{required:!0}],trigger:"onConfirm",onClick:p,children:a(_,{columns:k,children:e=>a(y,{val:e,textType:"time"})})})]}),a(l.Item,{name:"is_subscribe",className:`${u.noLabelFormItem} ${u.noBgFormItem}`,children:a(N.Group,{children:a(N,{value:"1",children:"\u4F11\u606F\u65F6\u95F4\u5141\u8BB8\u7EBF\u4E0A\u9884\u7EA6"})})}),a(l.Item,{name:"remark",label:"\u5907\u6CE8",children:a(z,{placeholder:"\u8F93\u5165"})}),a("div",{className:"fixed-b-btn flex",children:a(j,{className:"w-[65%] h-[2.75rem] rounded-3xl",block:!0,type:"submit",color:"primary",loadingIcon:a(Q,{}),loading:D,children:"\u4FDD\u5B58"})})]})]})]})}export{De as default};
