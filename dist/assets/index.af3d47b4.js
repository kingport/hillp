import{co as J,u as Q,i as W,s as X,r as g,a as ee,j as n,b as t,$ as te,B,S as G,cp as ae,T as _,aD as V}from"./index.5670e6e0.js";import{p as q}from"./pickBy.15fa557e.js";import{T as se}from"./index.21b1b6fd.js";import{F as m}from"./index.11c9b67d.js";import{I as C}from"./index.66fe089c.js";import{P as re}from"./index.77a6b2f7.js";import{D as oe}from"./dropdown.706ec38f.js";import{H as ie}from"./index.04556cd2.js";import{E as D}from"./index.1c39e7a0.js";import{U as le}from"./upload.3b886abe.js";import{M as k}from"./manage.653bb3f0.js";import{u as ne}from"./index.5733fb44.js";import{G as h,I as de}from"./init.01b19658.js";/* empty css                    *//* empty css                 */import"./dev-log.6e115cc9.js";import"./is-node-with-content.f661b98b.js";import"./interopRequireDefault.fc5525a1.js";import"./index.31244c45.js";import"./index.cb878f88.js";import"./convert-px.daab3cc2.js";import"./CloseCircleFill.55d4b485.js";import"./bound.bddb6539.js";import"./index.c6660251.js";import"./use-gesture-react.esm.346ddc85.js";import"./rubberband.c88fa690.js";import"./PurePanel.2a417db7.js";import"./index.42a6e0fb.js";import"./index.92e459fd.js";import"./collapse.e34cf270.js";import"./useFlexGapSupport.172cfcf4.js";const me="_customer_d50bl_1",ce="_phone_d50bl_48",ue="_area_d50bl_48",pe="_address_d50bl_67",y={customer:me,phone:ce,area:ue,address:pe};h.setApiKey(J);h.setLanguage("en");h.setRegion("es");h.setLocationType("ROOFTOP");function Ue(){var j,v,P,L,O,R;const[F]=m.useForm(),w=Q(),a=W(),A=(j=a==null?void 0:a.state)==null?void 0:j.from,p=ne(document.querySelector("body")),{area:i}=X.getState().global.areaRegion,S=g.exports.useRef(null),c=((v=a==null?void 0:a.state)==null?void 0:v.type)==="edit",[H,E]=g.exports.useState(!1),[x,N]=g.exports.useState([""]),[l,U]=g.exports.useState({file_path:"",file_url:""});g.exports.useEffect(()=>{N([i==null?void 0:i[0].name])},[i]),ee(()=>{var e,s,r;((e=a==null?void 0:a.state)==null?void 0:e.type)==="edit"&&(F.setFieldsValue({...(s=a.state)==null?void 0:s.formData}),N([(r=i.find(d=>{var u,b;return d.label===((b=(u=a.state)==null?void 0:u.formData)==null?void 0:b.area)}))==null?void 0:r.label]))});const I=async()=>{await F.validateFields().then(async e=>{var s,r,d,u,b,T;if(x&&(e.area=(s=i.find(o=>o.name===x[0]))==null?void 0:s.label),((l==null?void 0:l.file_path)||((d=(r=a.state)==null?void 0:r.formData)==null?void 0:d.head))&&(e.head=(l==null?void 0:l.file_path)||((u=a.state)==null?void 0:u.formData.head)),e.address)h.fromAddress(e.address).then(async o=>{var $,M;const{lat:Z,lng:z}=o.results[0].geometry.location;e.latitude=`${Z},${z}`,e=q(e,V);let f;c?f=await k.updataServer({...e,id:(M=($=a.state)==null?void 0:$.formData)==null?void 0:M.id}):f=await k.saveClient({...e}),f.status===200&&_.show({content:f==null?void 0:f.msg,afterClose:()=>{A&&A==="addOrder"?w("/manage/customer/list",{state:{from:"addOrder",...a==null?void 0:a.state}}):w(A&&A==="pcAddOrder"?"/calendar/add/order":"/manage/customer/list")}})},o=>{console.error(o)});else{e=q(e,V);let o;c?o=await k.updataServer({...e,id:(T=(b=a.state)==null?void 0:b.formData)==null?void 0:T.id}):o=await k.saveClient({...e}),o.status===200&&_.show({content:o==null?void 0:o.msg,afterClose:()=>{w(-1)}})}})},K=async e=>{const s=[...e.target.files];if(s.length){const r=await le.uploadFile(s);(r==null?void 0:r.status)===200&&(_.show(r.data.msg),U(r.data.data))}},Y=e=>{e!=null&&e.key&&N([i.find(s=>Number(s.value)===Number(e==null?void 0:e.key)).label])};return n("div",{className:`${y.customer} pt-[48px] pb-[90px] sm:w-full sm:flex sm:justify-center sm:pb-0`,children:[t(ie,{renderRight:!1}),n("div",{className:"flex flex-col px-10 py-12 sm:w-400px sm:px-0 sm:py-0",children:[t("p",{className:"text-2xl font-600 pb-10",children:c?"\u7F16\u8F91\u5BA2\u6237":"\u6DFB\u52A0\u65B0\u5BA2\u6237"}),n(m,{requiredMarkStyle:"none",form:F,footer:null,children:[n("div",{className:"flex items-center",children:[t(te,{name:c?(L=(P=a.state)==null?void 0:P.formData)==null?void 0:L.nickname:"",headurl:c?(R=(O=a.state)==null?void 0:O.formData)==null?void 0:R.head:l==null?void 0:l.file_url}),t(B,{loading:"auto",onClick:async()=>{await S.current.click()},className:"bg-[#f3f3f3] border-0 ml-4",shape:"rounded",loadingIcon:t(D,{}),children:"\u4E0A\u4F20\u5934\u50CF"}),t("input",{id:"file",type:"file",ref:S,accept:".jpg,.jpeg,.png",hidden:!0,onChange:e=>K(e)})]}),t(m.Item,{name:"nickname",label:"\u5BA2\u6237\u79F0\u547C",rules:[{required:!0}],children:t(C,{placeholder:"\u5BA2\u6237\u79F0\u547C"})}),t(m.Item,{name:"email",label:"\u5BA2\u6237\u90AE\u7BB1",children:t(C,{placeholder:"\u5BA2\u6237\u90AE\u7BB1"})}),n("div",{className:`${y.phone} flex flex-col pt-3`,children:[t("p",{className:"text-sm pb-3",children:"\u5BA2\u6237\u624B\u673A"}),n("div",{className:`flex items-center ${y.area}`,children:[n("div",{onClick:()=>{(p==null?void 0:p.width)&&(p==null?void 0:p.width)<=640&&E(!0)},className:"flex rounded-l-2xl items-center justify-center text-xs h-full pl-3 pr-2 justify-center",children:[t("span",{className:"w-25px sm:hidden",children:x}),t(oe,{menu:{items:i,onClick:Y},className:"<sm:hidden min-w-40px text-center",children:t("a",{onClick:e=>e.preventDefault(),children:x})}),t(G,{name:"phone-bottom",className:"w-[5px] h-[3px] ml-2"})]}),t(m.Item,{name:"phone",children:t(C,{placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\u7801",className:y.input})}),t(re,{columns:[i],visible:H,onClose:()=>{E(!1)},value:x,onConfirm:e=>{N([i.find(s=>s.value===e[0]).label])}})]})]}),t(m.Item,{className:y.address,layout:"vertical",label:"\u5730\u5740",children:n("div",{className:"flex items-center justify-between",children:[t(m.Item,{noStyle:!0,name:"address",children:t(de,{transparent:!0})}),t(G,{onClick:()=>{ae(e=>{const s=e.coords.latitude,r=e.coords.longitude;h.fromLatLng(s,r).then(d=>{const u=d.results[0].formatted_address;F.setFieldsValue({address:u})},d=>{_.show("Server returned status code ZERO_RESULTS"),console.error(d)})})},name:"location",className:"w-[20px] h-[20px] cursor-pointer mr-2"})]})}),t(m.Item,{name:"remark",label:"\u5907\u6CE8",children:t(se,{placeholder:"\u8F93\u5165"})}),n("div",{className:"fixed-b-btn flex justify-around sm:hidden",children:[t(B,{className:"w-[30%] border-0 bg-[#F3F3F3]",shape:"rounded",block:!0,size:"large",children:"\u53D6\u6D88"}),t(B,{onClick:I,className:"w-[30%]",shape:"rounded",block:!0,type:"submit",size:"large",loading:"auto",color:"primary",loadingIcon:t(D,{}),children:c?"\u4FDD\u5B58":"\u6DFB\u52A0"})]}),t("div",{className:"<sm:fixed-b-btn flex sm:my-10",children:t(B,{onClick:I,className:"w-[70%] h-[2.75rem] rounded-xl sm:w-25 sm:rounded-3xl",block:!0,type:"submit",color:"primary",loading:"auto",loadingIcon:t(D,{}),children:c?"\u4FDD\u5B58":" \u6DFB\u52A0 "})})]})]})]})}export{Ue as default};
