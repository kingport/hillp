import{co as xe,r as u,u as ye,s as ie,i as _e,k as ae,b as t,_ as be,j as r,$ as ge,B as q,S as D,F as R,cp as ke,O as Fe,T as B,aG as Ee,aD as Ne}from"./index.5670e6e0.js";import{F as n}from"./index.11c9b67d.js";import{I as x}from"./index.66fe089c.js";import{P as Ce,i as se}from"./index.77a6b2f7.js";import{d as ne}from"./differenceWith.1f2b7854.js";import{p as Se}from"./pickBy.15fa557e.js";import{D as Be}from"./dropdown.706ec38f.js";import{H as Ae}from"./index.04556cd2.js";import{s as l,T as V}from"./TimePriceItem.1fe90ca6.js";import{S as re}from"./index.73a4613c.js";import{E as oe}from"./index.1c39e7a0.js";import{U as $e}from"./upload.3b886abe.js";import{I as we}from"./information.c9048f81.js";import{M as A}from"./manage.653bb3f0.js";import{H as De}from"./index.9fe94518.js";import{G as $,I as Ie}from"./init.01b19658.js";import{u as Oe}from"./index.5733fb44.js";/* empty css                    *//* empty css                 */import"./is-node-with-content.f661b98b.js";import"./interopRequireDefault.fc5525a1.js";import"./dev-log.6e115cc9.js";import"./index.31244c45.js";import"./index.cb878f88.js";import"./convert-px.daab3cc2.js";import"./CloseCircleFill.55d4b485.js";import"./bound.bddb6539.js";import"./index.c6660251.js";import"./use-gesture-react.esm.346ddc85.js";import"./rubberband.c88fa690.js";import"./last.7ecc4488.js";import"./PurePanel.2a417db7.js";import"./index.42a6e0fb.js";import"./index.92e459fd.js";import"./collapse.e34cf270.js";import"./useFlexGapSupport.172cfcf4.js";$.setApiKey(xe);$.setLanguage("en");$.setRegion("es");$.setLocationType("ROOFTOP");function xt(){var Z,z,Q;const G=u.exports.useRef(null),[d]=n.useForm(),E=ye(),{area:y}=ie.getState().global.areaRegion,o=_e(),g=(Z=o==null?void 0:o.state)==null?void 0:Z.id,k=ie.getState().global.userInfo,F=Oe(document.querySelector("body")),[ce,H]=u.exports.useState(!1),[le,M]=u.exports.useState(!1),[N,I]=u.exports.useState([y[0].label]),[p,O]=u.exports.useState("%"),[_,j]=u.exports.useState("%"),[f,J]=u.exports.useState({file_path:"",file_url:""}),[L,K]=u.exports.useState(),[U,W]=u.exports.useState(),[P,Y]=u.exports.useState(),[T,ue]=u.exports.useState([]),{loading:me}=ae(()=>we.getInformationList({type:9}),{onSuccess(e){ue(e==null?void 0:e.data)}}),{data:i,run:de}=ae(()=>{var e;return A.getStaffDetail({id:(e=o==null?void 0:o.state)==null?void 0:e.id})},{manual:!0,onSuccess:e=>{var s,c,h,b,C;d.setFieldsValue({...e.data}),I([(s=y.find(w=>{var S;return w.label===((S=e==null?void 0:e.data)==null?void 0:S.area)}))==null?void 0:s.label]),e.data.cost_type===1&&O("%"),e.data.cost_type===2&&(O("$"),K(((c=e.data.cost)==null?void 0:c.eat_in)||[{}]),W(((h=e.data.cost)==null?void 0:h.take_out)||[{}])),e.data.introducer_type===1&&j("%"),e.data.introducer_type===2&&(j("$"),Y((b=e.data)==null?void 0:b.introducer_cost)),J({file_url:(C=e==null?void 0:e.data)==null?void 0:C.head,file_path:""})}});u.exports.useEffect(()=>{var e;(e=o==null?void 0:o.state)!=null&&e.id&&de()},[(z=o==null?void 0:o.state)==null?void 0:z.id]);const pe=async()=>{await d.validateFields().then(async e=>{var b,C,w,S,X,v,ee;N&&(e.area=(b=y.find(a=>a.name===N[0]))==null?void 0:b.label),((f==null?void 0:f.file_path)||((C=i==null?void 0:i.data)==null?void 0:C.head))&&(e.head=(f==null?void 0:f.file_path)||((w=i==null?void 0:i.data)==null?void 0:w.head));const s=[];if(L&&p==="$"){let a={};Object.keys(L).map(m=>{a={price:e.eat_in[`price_${m}`],time:e.eat_in[`time_${m}`][0]},s.push(a)})}const c=[];if(U&&p==="$"){let a={};Object.keys(U).map(m=>{a={price:e.take_out[`price_${m}`],time:e.take_out[`time_${m}`][0]},c.push(a)})}if(p==="$"){if(e.cost={eat_in:ne(s,[{time:void 0,price:void 0},{time:"",price:""}],se),take_out:ne(c,[{time:void 0,price:void 0},{time:"",price:""}],se)},!e.cost.eat_in.length&&!e.cost.take_out.length)return B.show("\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A");e.cost.eat_in.length&&e.cost.eat_in.map(a=>{if(!a.price||!a.time)throw B.show("\u8BF7\u5B8C\u5584\u6216\u6E05\u7A7A")}),e.cost.take_out.length&&e.cost.take_out.map(a=>{if(!a.price||!a.time)throw B.show("\u8BF7\u5B8C\u5584\u6216\u6E05\u7A7A")})}p==="$"?(e.cost_type=2,e.cost.take_out.length===0&&delete e.cost.take_out,e.cost.eat_in.length===0&&delete e.cost.eat_in,e.cost=JSON.stringify(e.cost),delete e.eat_in,delete e.take_out):e.cost_type=1;const h=[];if(P&&_==="$"){let a={};Object.keys(P).map(m=>{a={price:e.fee[`price_${m}`],time:e.fee[`time_${m}`][0]},h.push(a),delete e.fee})}if(_==="$"?(e.introducer_type=2,e.introducer_cost=JSON.stringify(h)):e.introducer_type=1,e=Se(e,Ne),((S=i==null?void 0:i.data)==null?void 0:S.cost)!==(e==null?void 0:e.cost)&&((X=i==null?void 0:i.data)==null?void 0:X.type)===3)Ee.show({content:r("div",{className:"font-600 text-center pb-2 text-xl",children:[(k==null?void 0:k.user_type)===2&&t("p",{children:"\u7B7E\u7EA6\u5458\u5DE5\u66F4\u6539\u6210\u672C\u9700\u5BF9\u65B9\u540C\u610F"}),(k==null?void 0:k.user_type)===1&&t("p",{children:"\u7B7E\u7EA6\u6E20\u9053\u66F4\u6539\u6210\u672C\u9700\u5BF9\u65B9\u540C\u610F"}),t("p",{children:"\u662F\u5426\u786E\u8BA4\u66F4\u6539"})]}),closeOnAction:!0,actions:[[{key:"cancel",text:"\u53D6\u6D88",className:"dialog-cancel",onClick(){}},{key:"confirm",text:"\u786E\u8BA4",className:"dialog-confirm",async onClick(){var m,te;let a;g?(e.type=(m=i==null?void 0:i.data)==null?void 0:m.type,e.id=(te=o.state)==null?void 0:te.id,a=await A.editStaff({...e})):a=await A.addStaff({...e}),a.status===200&&E("/manage/employee/list")}}]]});else{let a;g?(e.type=(v=i==null?void 0:i.data)==null?void 0:v.type,e.id=(ee=o.state)==null?void 0:ee.id,a=await A.editStaff({...e})):a=await A.addStaff({...e}),a.status===200&&E("/manage/employee/list")}})},fe=async e=>{const s=[...e.target.files];if(s.length){const c=await $e.uploadFile(s);(c==null?void 0:c.status)===200&&(B.show(c.data.msg),J(c.data.data))}},he=e=>{e!=null&&e.key&&I([y.find(s=>Number(s.value)===Number(e==null?void 0:e.key)).label])};return me?t(be,{color:"primary"}):r("div",{className:`${l.AddEmployeeForm} pt-[48px] pb-[90px] bg-[#fff] sm:w-full sm:flex sm:justify-center sm:pb-0`,children:[t(Ae,{renderRight:!1,title:`${g?"\u7F16\u8F91\u5458\u5DE5\u8D44\u6599":"\u6DFB\u52A0\u5458\u5DE5\u8D44\u6599"}`,border:!0}),t("div",{className:"flex flex-col px-10 py-12 sm:w-500px sm:px-0 sm:py-0",children:r(n,{form:d,requiredMarkStyle:"none",layout:"horizontal",footer:null,children:[r("div",{className:"flex items-center",children:[t(ge,{name:(Q=i==null?void 0:i.data)==null?void 0:Q.name,headurl:f==null?void 0:f.file_url}),t(q,{loading:"auto",onClick:async()=>{await G.current.click()},className:"bg-[#f3f3f3] border-0 ml-5",shape:"rounded",loadingIcon:t(oe,{}),children:"\u4E0A\u4F20\u5934\u50CF"}),t("input",{id:"file",type:"file",ref:G,accept:".jpg,.jpeg,.png",hidden:!0,onChange:e=>fe(e)})]}),t("p",{className:"pt-12 pb-4",children:"\u57FA\u672C\u8D44\u6599"}),t(n.Item,{name:"nickname",label:"\u5458\u5DE5\u79F0\u547C*",rules:[{required:!0}],children:t(x,{placeholder:"\u5458\u5DE5\u79F0\u547C"})}),t(n.Item,{name:"email",label:"\u5458\u5DE5\u90AE\u7BB1",children:t(x,{placeholder:"\u5458\u5DE5\u90AE\u7BB1"})}),t(n.Item,{label:"\u5458\u5DE5\u624B\u673A*",children:r("div",{className:l.phone,children:[r("div",{onClick:()=>{(F==null?void 0:F.width)&&(F==null?void 0:F.width)<=640&&M(!0)},className:`${l.phoneCode} text-xs h-full pl-3 pr-2 flex items-center justify-center`,children:[t("p",{className:"min-w-30px pl-1 sm:hidden",children:N}),t(Be,{menu:{items:y,onClick:he},className:"<sm:hidden min-w-40px text-center",children:t("a",{onClick:e=>e.preventDefault(),children:N})}),t(D,{name:"phone-bottom",className:"w-[5px] h-[3px] ml-2"})]}),t(Ce,{columns:[y],visible:le,onClose:()=>{M(!1)},value:N,onConfirm:e=>{I([y.find(s=>s.value===e[0]).label])}}),t(n.Item,{noStyle:!0,name:"phone",rules:[{required:!0}],children:t(x,{placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\u7801",className:l.input})})]})}),t("div",{className:"border-b my-8"}),t(n.Item,{label:"\u5458\u5DE5\u6210\u672C*",children:r("div",{className:"flex items-center",children:[r("div",{className:`${l.cost} flex-1 flex items-center mr-2`,children:[t("span",{className:"text-xs pl-3 w-6 flex items-center justify-center",children:p}),p==="$"&&t(n.Item,{noStyle:!0,rules:[{required:!1}],children:t(x,{disabled:!0,placeholder:"0.00",className:`${l.input} flex-1`})}),p!=="$"&&t(n.Item,{noStyle:!0,name:"cost",rules:[{required:!0}],children:t(x,{placeholder:"0.00",className:`${l.input}`})})]}),t(re,{valueUnit:p,changeConfirm:e=>{O(e),d.setFieldsValue({cost:""})},leftUnit:"%",rightUnit:"$"})]})}),p==="$"&&r(R,{children:[t(n.Item,{className:`${l.dineIn} mt-4`,name:"eat_in",label:"\u5802\u98DF",children:t(V,{form:d,timePicker:T,list:L,setList:K,keyTitle:"eat_in"})}),t(n.Item,{className:`${l.takeOut}`,name:"take_out",label:"\u5916\u5356",children:t(V,{timePicker:T,list:U,setList:W,keyTitle:"take_out",form:d})})]}),t(n.Item,{name:"introducer",label:"\u4ECB\u7ECD\u4EBA",children:t(x,{placeholder:"\u4ECB\u7ECD\u4EBA "})}),t(n.Item,{label:"\u4ECB\u7ECD\u8D39",children:r("div",{className:"flex items-center",children:[r("div",{className:`${l.cost} flex flex-1 items-center mr-2`,children:[t("span",{className:"text-xs pl-3 w-6 flex items-center justify-center",children:_}),_==="$"&&t(n.Item,{noStyle:!0,rules:[{required:!1}],children:t(x,{disabled:!0,placeholder:"0.00",className:`${l.input} flex-1`})}),_!=="$"&&t(n.Item,{noStyle:!0,name:"introducer_cost",rules:[{required:!1}],children:t(x,{placeholder:"0.00",className:`${l.input} flex-1`})})]}),t(re,{valueUnit:_,changeConfirm:e=>{j(e),d.setFieldsValue({introducer_cost:""})},leftUnit:"%",rightUnit:"$"})]})}),_==="$"&&t(R,{children:t(n.Item,{className:`${l.dineIn} mt-4`,name:"introducer_cost",children:t(V,{form:d,timePicker:T,list:P,setList:Y,keyTitle:"fee"})})}),t("div",{className:"border-b my-8"}),t(n.Item,{layout:"vertical",label:"\u5730\u5740\uFF08\u9009\u586B\uFF09",children:r("div",{className:"flex items-center justify-between",children:[t(n.Item,{noStyle:!0,name:"address",children:t(Ie,{})}),t(D,{onClick:()=>{ke(async e=>{const s=e.coords.latitude,c=e.coords.longitude;$.fromLatLng(s,c).then(h=>{const b=h.results[0].formatted_address;d.setFieldsValue({address:b})},h=>{B.show("Server returned status code ZERO_RESULTS")})})},name:"location",className:"w-[20px] h-[20px] cursor-pointer"})]})}),g&&r(R,{children:[t("div",{className:"border-b my-8 hidden sm:flex"}),r("div",{onClick:()=>{var e,s;E("/manage/employee/info/edit/detail",{state:{id:(e=i==null?void 0:i.data)==null?void 0:e.id,nickname:(s=i==null?void 0:i.data)==null?void 0:s.nickname}})},className:"hidden sm:flex sm:items-center sm:cursor-pointer sm:text-sm",children:[t(D,{name:"edit",className:"w-[17px] h-[17px]"}),t("p",{className:"text-color-[#7B7B7B] pl-5 hover:underline hover:text-color-[#2A4948]",children:"\u7F16\u8F91\u8BE6\u7EC6\u8D44\u6599"})]})]}),r("div",{className:"<sm:fixed-b-btn flex sm:my-20",children:[g&&t(q,{onClick:()=>H(!0),className:"sm:hidden w-[12%] flex items-center justify-center mr-4 h-[2.75rem] rounded-xl border-0 bg-[#F3F3F3]",block:!0,children:t(D,{name:"point",className:"w-[15px] h-[3px]"})}),t(q,{onClick:pe,className:"w-[70%] h-[2.75rem] rounded-xl sm:w-25 sm:rounded-3xl",block:!0,type:"submit",color:"primary",loading:"auto",loadingIcon:t(oe,{}),children:g?"\u66F4\u65B0":" \u6DFB\u52A0"})]}),t(De,{actions:[{text:"\u7F16\u8F91\u8BE6\u7EC6\u8D44\u6599",key:"editDetail",onClick:()=>{var e,s;E("/manage/employee/info/edit/detail",{state:{id:(e=i==null?void 0:i.data)==null?void 0:e.id,nickname:(s=i==null?void 0:i.data)==null?void 0:s.nickname}})}}],visible:ce,setVisible:H})]})}),t("div",{onClick:()=>E(-1),className:"fixed top-80px right-40px <sm:hidden",children:t(Fe,{fontSize:24,className:"cursor-pointer"})})]})}export{xt as default};
