import{u as q,s as T,i as P,r as p,k as w,b as e,_ as L,j as m,F as U,B as D,O as V,T as x,aD as M}from"./index.5670e6e0.js";import{F as n}from"./index.11c9b67d.js";import{I as g}from"./index.66fe089c.js";import{P as I,i as N}from"./index.77a6b2f7.js";import{p as R}from"./pickBy.15fa557e.js";import{d as $}from"./differenceWith.1f2b7854.js";import{S as C}from"./index.0a2bddee.js";import{H}from"./index.04556cd2.js";import{S as J}from"./index.73a4613c.js";import{T as E}from"./TimePriceItem.1fe90ca6.js";import{E as W}from"./index.1c39e7a0.js";import{u as G}from"./index.5733fb44.js";import{I as K}from"./information.c9048f81.js";import{M as A}from"./manage.653bb3f0.js";/* empty css                    *//* empty css                 */import"./is-node-with-content.f661b98b.js";import"./interopRequireDefault.fc5525a1.js";import"./dev-log.6e115cc9.js";import"./index.31244c45.js";import"./index.cb878f88.js";import"./convert-px.daab3cc2.js";import"./CloseCircleFill.55d4b485.js";import"./bound.bddb6539.js";import"./index.c6660251.js";import"./use-gesture-react.esm.346ddc85.js";import"./rubberband.c88fa690.js";import"./last.7ecc4488.js";import"./PurePanel.2a417db7.js";import"./index.42a6e0fb.js";import"./statusUtils.6dc02607.js";import"./DownOutlined.9a14fa90.js";import"./SearchOutlined.a0283b8c.js";const Q="_channel_1r3bx_1",X="_AddpromoteForm_1r3bx_7",Y="_cost_1r3bx_59",Z="_input_1r3bx_66",v="_dineIn_1r3bx_73",z="_price_1r3bx_98",tt="_takeOut_1r3bx_108",l={channel:Q,AddpromoteForm:X,"adm-list-item-disabled":"_adm-list-item-disabled_1r3bx_46",cost:Y,input:Z,dineIn:v,price:z,takeOut:tt};function Pt(){const[s]=n.useForm(),F=q(),{region:b}=T.getState().global.areaRegion;P();const i=G(document.querySelector("body")),[a,h]=p.exports.useState(""),[f,k]=p.exports.useState(),[_,y]=p.exports.useState(),[d,S]=p.exports.useState([]),{data:et,loading:O}=w(()=>K.getInformationList({type:9}),{onSuccess(t){S(t==null?void 0:t.data)}}),{loading:B}=w(()=>A.getOnlineDetail({}),{onSuccess:t=>{t.data.region=[t.data.region],t.data.min_duration=[`${t.data.min_duration}`],t.data.cost_type===1&&h("%"),t.data.cost_type===2&&(h("$"),k(t.data.cost.eat_in),y(t.data.cost.take_out)),s.setFieldsValue({...t.data})}}),j=async()=>{await s.validateFields().then(async t=>{t.region=t.region[0],t.min_duration=t.min_duration[0];const o=[];if(f&&a==="$"){let r={};Object.keys(f).map(u=>{r={price:t.eat_in[`price_${u}`],time:t.eat_in[`time_${u}`][0]},o.push(r)})}const c=[];if(_&&a==="$"){let r={};Object.keys(_).map(u=>{r={price:t.take_out[`price_${u}`],time:t.take_out[`time_${u}`][0]},c.push(r)})}if(a==="$"){if(t.cost={eat_in:$(o,[{time:void 0,price:void 0},{time:"",price:""}],N),take_out:$(c,[{time:void 0,price:void 0},{time:"",price:""}],N)},!t.cost.eat_in.length&&!t.cost.take_out.length)return x.show("\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A");t.cost.eat_in.length&&t.cost.eat_in.map(r=>{if(!r.price||!r.time)throw x.show("\u8BF7\u5B8C\u5584\u6216\u6E05\u7A7A")}),t.cost.take_out.length&&t.cost.take_out.map(r=>{if(!r.price||!r.time)throw x.show("\u8BF7\u5B8C\u5584\u6216\u6E05\u7A7A")})}a==="$"?(t.cost_type=2,t.cost.take_out.length===0&&delete t.cost.take_out,t.cost.eat_in.length===0&&delete t.cost.eat_in,t.cost=JSON.stringify(t.cost),delete t.eat_in,delete t.take_out):t.cost_type=1,t=R(t,M),(await A.nowPromotion({...t})).status===200&&F("/manage/add/channel")})};return O||B?e(L,{color:"primary"}):m("div",{className:`${l.AddpromoteForm} pt-[48px] pb-[90px] bg-[#fff] !sm:min-h-[calc(100vh-60px)] sm:p-0 sm:flex sm:justify-center sm:items-center`,children:[e(H,{renderRight:!1,title:"\u586B\u5199\u63A8\u5E7F\u8D44\u6599",border:!0}),m("div",{className:"flex flex-col px-8 py-12 sm:w-400px",children:[e("p",{className:"font-600 text-2xl pb-4",children:"\u7F16\u8F91\u6210\u672C"}),m(n,{form:s,requiredMarkStyle:"none",layout:"horizontal",footer:null,children:[e(n.Item,{label:"\u6210\u672C",children:m("div",{className:"flex items-center",children:[m("div",{className:`${l.cost} flex items-center mr-2`,children:[e("span",{className:"text-xs pl-3 w-6 flex items-center justify-center",children:a}),a==="$"&&e(n.Item,{noStyle:!0,rules:[{required:!1}],children:e(g,{disabled:!0,placeholder:"0.00",className:`${l.input}`})}),a!=="$"&&e(n.Item,{noStyle:!0,name:"cost",rules:[{required:!0}],children:e(g,{placeholder:"0.00",className:`${l.input}`})})]}),e(J,{valueUnit:a,changeConfirm:t=>{h(t),s.setFieldsValue({cost:""})},leftUnit:"%",rightUnit:"$"})]})}),a==="$"&&m(U,{children:[e(n.Item,{className:`${l.dineIn} mt-4`,name:"eat_in",label:"\u5802\u98DF",children:e(E,{form:s,timePicker:d,list:f,setList:k,keyTitle:"eat_in"})}),e(n.Item,{className:`${l.takeOut}`,name:"take_out",label:"\u5916\u5356",children:e(E,{form:s,timePicker:d,list:_,setList:y,keyTitle:"take_out"})})]}),e(n.Item,{name:"min_price",label:"\u6BCF\u5355\u6700\u4F4E\u4EF7",rules:[{required:!0}],children:e(g,{placeholder:"\u6BCF\u5355\u6700\u4F4E\u4EF7"})}),e(n.Item,{name:"min_duration",label:"\u6700\u4F4E\u65F6\u957F",trigger:"onConfirm",onClick:(t,o)=>{var c;if((i==null?void 0:i.width)&&(i==null?void 0:i.width)>640)return!1;(c=o.current)==null||c.open()},rules:[{required:!0}],children:(i==null?void 0:i.width)&&(i==null?void 0:i.width)>640?e(C,{style:{width:"100%"},onChange:t=>{s.setFieldsValue({min_duration:[t]})},options:d}):e(I,{columns:[d],children:t=>{var o;return e("span",{className:"text-xs rounded-3xl bg-[#f7f7f7] min-h-8 pl-3 flex items-center",children:((o=t[0])==null?void 0:o.label)||e("span",{className:"text-color-[#ccc]",children:"\u8BF7\u9009\u62E9\u6700\u4F4E\u65F6\u957F"})})}})}),e(n.Item,{name:"region",label:"\u5730\u533A",trigger:"onConfirm",onClick:(t,o)=>{var c;if((i==null?void 0:i.width)&&(i==null?void 0:i.width)>640)return!1;(c=o.current)==null||c.open()},rules:[{required:!0}],children:(i==null?void 0:i.width)&&(i==null?void 0:i.width)>640?e(C,{style:{width:"100%"},onChange:t=>{s.setFieldsValue({region:[t]})},options:b}):e(I,{columns:[b],children:t=>{var o;return e("span",{className:"text-xs rounded-3xl bg-[#f7f7f7] min-h-8 pl-3 flex items-center",children:((o=t[0])==null?void 0:o.label)||e("span",{className:"text-color-[#ccc]",children:"\u8BF7\u9009\u62E9\u5730\u533A"})})}})}),e("div",{className:"<sm:fixed-b-btn flex sm:mt-5",children:e(D,{onClick:j,className:"w-[70%] h-[2.75rem] sm:w-120px",block:!0,shape:"rounded",type:"submit",color:"primary",loading:"auto",loadingIcon:e(W,{}),children:"\u7ACB\u5373\u63A8\u5E7F"})})]})]}),(i==null?void 0:i.width)&&(i==null?void 0:i.width)>=640?e("div",{onClick:()=>F(-1),className:"fixed top-80px right-40px",children:e(V,{fontSize:24,className:"cursor-pointer"})}):null]})}export{Pt as default};
